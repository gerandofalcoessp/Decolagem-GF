const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BviM__eE.js","assets/ui-C_BmRRy8.js","assets/vendor-Psgnp9ei.js","assets/router-DVMx2JKX.js","assets/query-BI71cv7L.js","assets/supabase-CfsjXCJe.js","assets/icons-TwYroKGA.js","assets/forms-BADiA78i.js","assets/utils-CwAUyRUs.js","assets/charts-C4lFoNLr.js","assets/index-m8cVvzE2.css"])))=>i.map(i=>d[i]);
import{j as e}from"./ui-C_BmRRy8.js";import{C as a}from"./Card-CcnntGPu.js";import{B as r}from"./Button-BrWxLG0o.js";import{r as s}from"./vendor-Psgnp9ei.js";import{A as o,f as t,b as i,L as n}from"./index-BviM__eE.js";import{u as l,N as d}from"./NotificationModal-D6g0G2c8.js";import{u as c}from"./query-BI71cv7L.js";import{_ as m}from"./supabase-CfsjXCJe.js";import{b as g,A as u,R as x,P as b,S as p}from"./constants-CFLPoYHQ.js";import{n as h,X as v,a as f,m as j,O as N,k as y,t as S,b as R}from"./icons-TwYroKGA.js";import{a as C}from"./router-DVMx2JKX.js";import"./forms-BADiA78i.js";import"./utils-CwAUyRUs.js";import"./charts-C4lFoNLr.js";function w({isOpen:a,onClose:o,onSubmit:d,regionalId:c}){const f=s.useRef(null),j=s.useRef(null),N=s.useRef(null),{user:y}=t(),[S,R]=s.useState({atividade:"",atividadeLabel:"",atividadeCustomLabel:"",responsavel:"",descricao:"",dataAtividade:"",regional:c||"nacional",estados:[],programa:[],instituicaoId:"",evidencias:[],quantidade:void 0,regionaisNPS:[]}),[C,w]=s.useState([]),[A,E]=s.useState([]),[P,M]=s.useState(""),{data:_,loading:k,error:B}=i();l();const L={nacional:["nacional"],centroeste:["centroeste","centro-oeste","centrooeste","r. centro-oeste","r.centro-oeste"],centro_oeste:["centroeste","centro-oeste","centrooeste","r. centro-oeste","r.centro-oeste"],nordeste:["nordeste"],nordeste_1:["nordeste1","nordeste 1","nordeste_1","r.nordeste1","r. nordeste 1","r.nordeste 1"],nordeste_2:["nordeste2","nordeste 2","nordeste_2","r.nordeste2","r. nordeste 2","r.nordeste 2"],norte:["norte"],rj:["rj","riodejaneiro","rio de janeiro","r. rio de janeiro","r.rio de janeiro"],sp:["sp","saopaulo","são paulo","sao paulo","r. sao paulo","r.sao paulo","r. são paulo","r.são paulo"],sul:["sul"],mg_es:["mg/es","mg es","mges","minas gerais","espirito santo","r. mg/es","r.mg/es"]},O=(_||[]).filter(e=>{var a;const r=e.regional||e.area||(null==(a=e.user_metadata)?void 0:a.regional)||"",s=r.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim();"centroeste"===S.regional||r.toLowerCase().includes("centro");let o=S.regional;"nordeste_2"===S.regional&&(o="nordeste_2");const t=(L[o]||[]).some(e=>s.includes(e)),i="nacional"===s;return S.regional,"nacional"===S.regional?t||i:t}).sort((e,a)=>(e.nome||e.email||"").localeCompare(a.nome||a.email||""));s.useEffect(()=>{"centroeste"===S.regional&&_&&_.length},[S.regional,null==_?void 0:_.length]),s.useEffect(()=>{a&&(R({atividade:"",atividadeLabel:"",atividadeCustomLabel:"",responsavel:"",descricao:"",dataAtividade:"",regional:c||"nacional",estados:[],programa:"",instituicaoId:"",evidencias:[],quantidade:void 0}),M(""))},[a,c]),s.useEffect(()=>{if(!a)return;(async()=>{try{const{InstituicaoService:e}=await m(async()=>{const{InstituicaoService:e}=await import("./index-BviM__eE.js").then(e=>e.p);return{InstituicaoService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])),a=await e.getInstituicoes(),r=null==y?void 0:y.regional,s=(e=>{if(!e)return"";return{"R. Norte":"norte","R. Centro-Oeste":"centro_oeste","R. Nordeste":"nordeste","R. Sudeste":"sudeste","R. Sul":"sul","R. MG/ES":"mg_es","R. Rio de Janeiro":"rj","R. São Paulo":"sp","R. Nordeste 1":"nordeste_1","R. Nordeste 2":"nordeste_2",Nacional:"nacional",Comercial:"comercial",norte:"norte",centro_oeste:"centro_oeste",nordeste:"nordeste",sudeste:"sudeste",sul:"sul",mg_es:"mg_es",rj:"rj",sp:"sp",nordeste_1:"nordeste_1",nordeste_2:"nordeste_2",nacional:"nacional",comercial:"comercial"}[e]||e.toLowerCase()})(r||"");let o;o="nacional"===s||"super_admin"===(null==y?void 0:y.role)?a:a.filter(e=>e.regional===s);const t=o.map(e=>({id:e.id,nome:e.nome})).filter(e=>e.id&&e.nome);E(t)}catch(e){E([])}})()},[a,null==y?void 0:y.regional]),s.useEffect(()=>{if(!a)return;f.current&&f.current.focus(),N.current=document.activeElement;const e=e=>{"Escape"===e.key&&I()};return document.addEventListener("keydown",e),()=>{var a;document.removeEventListener("keydown",e),null==(a=N.current)||a.focus()}},[a]);const I=()=>{R({atividade:"",atividadeLabel:"",atividadeCustomLabel:"",responsavel:"",descricao:"",dataAtividade:"",regional:c||"nacional",estados:[],programa:"",instituicaoId:"",evidencias:[],quantidade:void 0}),M(""),o()};if(!a)return null;const D=g[S.regional]||[];return e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-[2px] flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-label":"Registrar Atividade",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-3xl max-h-[90vh] overflow-y-auto shadow-2xl ring-1 ring-gray-200",ref:j,tabIndex:-1,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-xl",children:e.jsx(h,{className:"w-6 h-6 text-orange-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 leading-tight",children:"Registrar Atividade"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Registre atividades para contabilizar nas metas"})]})]}),e.jsx("button",{"aria-label":"Fechar modal",className:"p-2 rounded-xl hover:bg-gray-100 transition-colors",onClick:I,children:e.jsx(v,{className:"w-5 h-5","aria-hidden":"true"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Tipo de Atividade *"}),e.jsxs("select",{ref:f,"aria-label":"Selecionar tipo de atividade",value:S.atividade,onChange:e=>{const a=[...u,...C].find(a=>a.value===e.target.value);R({...S,atividade:e.target.value,atividadeLabel:(null==a?void 0:a.label)||e.target.value})},className:"w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 shadow-sm transition-colors",children:[e.jsx("option",{value:"",children:"Selecione uma atividade"}),u.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value)),C.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]}),"nps"===S.atividade&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Regionais para aplicar NPS *"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 p-4 border border-gray-300 rounded-xl bg-gray-50",children:Object.entries(x).filter(([e])=>"todas"!==e).map(([a,r])=>{var s;return e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:(null==(s=S.regionaisNPS)?void 0:s.includes(a))||!1,onChange:e=>{const r=S.regionaisNPS||[];e.target.checked?R({...S,regionaisNPS:[...r,a]}):R({...S,regionaisNPS:r.filter(e=>e!==a)})},className:"rounded border-gray-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:r})]},a)})}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"Selecione as regionais onde a nota NPS será aplicada"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Programas *"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 p-4 border border-gray-300 rounded-xl bg-gray-50",children:Object.entries(b).map(([a,r])=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:!!Array.isArray(S.programa)&&S.programa.includes(a),onChange:e=>{const r=Array.isArray(S.programa)?S.programa:[];e.target.checked?R({...S,programa:[...r,a]}):R({...S,programa:r.filter(e=>e!==a)})},className:"rounded border-gray-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:r})]},a))}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"Selecione um ou mais programas para esta atividade"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Quantidade"}),e.jsx("input",{type:"number",min:0,step:1,"aria-label":"Quantidade",value:"number"==typeof S.quantidade?S.quantidade:"",onChange:e=>{const a=e.target.value,r=""===a?void 0:Math.max(0,Math.floor(Number(a)));R({...S,quantidade:r})},className:"w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 shadow-sm transition-colors",placeholder:"Informe a quantidade (opcional)"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Use para contabilizar itens como pessoas atendidas, encontros realizados, etc."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Instituição"}),e.jsxs("select",{"aria-label":"Selecionar instituição",value:S.instituicaoId||"",onChange:e=>R({...S,instituicaoId:e.target.value}),className:"w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 shadow-sm transition-colors",children:[e.jsx("option",{value:"",children:"Nenhuma instituição"}),A.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]})]}),!c&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Regional *"}),e.jsx("select",{"aria-label":"Selecionar regional",value:S.regional,onChange:e=>R({...S,regional:e.target.value}),className:"w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-sm shadow-sm transition-colors",children:Object.entries(x).filter(([e])=>"todas"!==e).map(([a,r])=>e.jsx("option",{value:a,children:r},a))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Data da Atividade *"}),e.jsx("input",{type:"date","aria-label":"Data da atividade",value:S.dataAtividade,onChange:e=>R({...S,dataAtividade:e.target.value}),className:"w-full md:max-w-[220px] border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-sm shadow-sm transition-colors",placeholder:"dd/mm/yyyy"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Responsável"}),e.jsxs("select",{"aria-label":"Selecionar responsável",value:S.responsavel,onChange:e=>R({...S,responsavel:e.target.value}),className:"w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 shadow-sm transition-colors",children:[e.jsx("option",{value:"",children:"Selecione um responsável"}),k&&e.jsx("option",{disabled:!0,children:"Carregando usuários..."}),B&&e.jsx("option",{disabled:!0,children:"Erro ao carregar usuários"}),O.filter(e=>e.id&&"string"==typeof e.id&&e.id.length>0).map(a=>e.jsx("option",{value:a.id,children:a.nome||a.email},a.id))]})]})]}),D.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Estado(s)"}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Selecione os estados onde a atividade foi realizada"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>R({...S,estados:[...D]}),className:"text-xs text-orange-600 hover:text-orange-700 font-medium",children:"Selecionar todos"}),e.jsx("button",{type:"button",onClick:()=>R({...S,estados:[]}),className:"text-xs text-gray-500 hover:text-gray-600 font-medium",children:"Limpar"})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 max-h-32 overflow-y-auto border border-gray-200 rounded-lg p-3",children:D.map(a=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:S.estados.includes(a),onChange:e=>{const r=e.target.checked,s={...S,estados:r?Array.from(new Set([...S.estados,a])):S.estados.filter(e=>e!==a)};R(s)},className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm text-gray-700",children:[p[a]||a," (",a,")"]})]},a))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Marque as caixas para selecionar múltiplos estados."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Descrição"}),e.jsx("textarea",{"aria-label":"Descrição da atividade",value:S.descricao,onChange:e=>R({...S,descricao:e.target.value}),className:"w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 shadow-sm transition-colors",rows:3,placeholder:"Descrição detalhada da atividade"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Evidências"}),e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Adicione até 2 fotos como evidência da atividade realizada (JPG, JPEG, PNG, WebP · máx. 5MB cada)."}),e.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",multiple:!0,onChange:e=>(async e=>{if(!e)return;const a=["image/jpeg","image/jpg","image/png","image/webp"],r=2-(S.evidencias||[]).length,s=Array.from(e).slice(0,Math.max(0,r));if(s.find(e=>!a.includes(e.type)||e.size>5242880))return void M("Formato inválido ou arquivo maior que 5MB. Aceitos: JPG, JPEG, PNG, WebP.");M("");const o=e=>new Promise((a,r)=>{const s=new FileReader;s.onload=()=>a(s.result),s.onerror=r,s.readAsDataURL(e)}),t=[];for(const n of s){const e=await o(n);t.push({id:`${n.name}-${Date.now()}`,filename:n.name,mimeType:n.type,size:n.size,url:e,created_at:(new Date).toISOString()})}const i=S.evidencias||[];R({...S,evidencias:[...i,...t].slice(0,2)})})(e.target.files),className:"block w-full text-sm text-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-orange-50 file:text-orange-700 hover:file:bg-orange-100"}),P&&e.jsx("p",{className:"text-xs text-red-600 mt-2",children:P}),S.evidencias&&S.evidencias.length>0&&e.jsx("div",{className:"mt-3 grid grid-cols-2 gap-3",children:S.evidencias.slice(0,5).map(a=>e.jsxs("div",{className:"border rounded-xl p-2 flex items-center space-x-2",children:[a.url?e.jsx(n,{src:a.url,alt:a.filename,className:"w-16 h-16 object-cover rounded-md",width:64,height:64}):e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-md"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-800 truncate",children:a.filename}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(a.size/1048576).toFixed(2)," MB"]})]}),e.jsx(r,{variant:"destructive",onClick:()=>{return e=a.id,void R({...S,evidencias:(S.evidencias||[]).filter(a=>a.id!==e)});var e},className:"rounded-md",children:"Remover"})]},a.id))})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200 mt-6",children:[e.jsx(r,{variant:"outline",onClick:I,className:"px-6 rounded-xl shadow-sm",children:"Cancelar"}),e.jsx(r,{onClick:()=>{S.atividade&&S.dataAtividade&&S.regional&&Array.isArray(S.programa)&&0!==S.programa.length?"nps"!==S.atividade||S.regionaisNPS&&0!==S.regionaisNPS.length?(d(S),I()):alert("Para atividades NPS, você deve selecionar pelo menos uma regional."):alert("Por favor, preencha todos os campos obrigatórios.")},className:"px-6 bg-orange-500 hover:bg-orange-600 text-white rounded-xl shadow-sm",disabled:!(S.atividade&&S.dataAtividade&&S.regional&&S.programa),"aria-disabled":!(S.atividade&&S.dataAtividade&&S.regional&&S.programa),children:"Registrar Atividade"})]})]})})}const A={Nacional:"bg-blue-50 border-blue-200",Comercial:"bg-green-50 border-green-200","Centro-Oeste":"bg-purple-50 border-purple-200",Norte:"bg-teal-50 border-teal-200",Nordeste:"bg-violet-50 border-violet-200",Sudeste:"bg-emerald-50 border-emerald-200",Sul:"bg-indigo-50 border-indigo-200","MG/ES":"bg-lime-50 border-lime-200","Rio de Janeiro":"bg-cyan-50 border-cyan-200","São Paulo":"bg-rose-50 border-rose-200","Nordeste 1":"bg-amber-50 border-amber-200","Nordeste 2":"bg-orange-50 border-orange-200","R. Centro-Oeste":"bg-purple-50 border-purple-200","R. Norte":"bg-teal-50 border-teal-200","R. Nordeste":"bg-violet-50 border-violet-200","R. Sudeste":"bg-emerald-50 border-emerald-200","R. Sul":"bg-indigo-50 border-indigo-200","R. MG/ES":"bg-lime-50 border-lime-200","R. Rio de Janeiro":"bg-cyan-50 border-cyan-200","R. São Paulo":"bg-rose-50 border-rose-200","R. Nordeste 1":"bg-amber-50 border-amber-200","R. Nordeste 2":"bg-orange-50 border-orange-200",nacional:"bg-blue-50 border-blue-200",comercial:"bg-green-50 border-green-200","centro-oeste":"bg-purple-50 border-purple-200",centro_oeste:"bg-purple-50 border-purple-200",norte:"bg-teal-50 border-teal-200",nordeste:"bg-violet-50 border-violet-200",sudeste:"bg-emerald-50 border-emerald-200",sul:"bg-indigo-50 border-indigo-200","mg/es":"bg-lime-50 border-lime-200",mg_es:"bg-lime-50 border-lime-200","rio de janeiro":"bg-cyan-50 border-cyan-200",rj:"bg-cyan-50 border-cyan-200","são paulo":"bg-rose-50 border-rose-200",sp:"bg-rose-50 border-rose-200","nordeste 1":"bg-amber-50 border-amber-200",nordeste_1:"bg-amber-50 border-amber-200","nordeste 2":"bg-orange-50 border-orange-200",nordeste_2:"bg-orange-50 border-orange-200","Sem Regional":"bg-gray-50 border-gray-200","sem regional":"bg-gray-50 border-gray-200"},E={Nacional:["Todos os Estados"],nacional:["Todos os Estados"],Comercial:["Todos os Estados"],comercial:["Todos os Estados"],"Centro-Oeste":["DF","GO","MT","MS"],"centro-oeste":["DF","GO","MT","MS"],centro_oeste:["DF","GO","MT","MS"],"R. Centro-Oeste":["DF","GO","MT","MS"],Norte:["AC","AP","AM","PA","RO","RR","TO"],norte:["AC","AP","AM","PA","RO","RR","TO"],"R. Norte":["AC","AP","AM","PA","RO","RR","TO"],Nordeste:["CE","PB","RN","MA","PI","BA","SE","PE","AL"],nordeste:["CE","PB","RN","MA","PI","BA","SE","PE","AL"],"R. Nordeste":["CE","PB","RN","MA","PI","BA","SE","PE","AL"],Sudeste:["MG","ES","RJ","SP"],sudeste:["MG","ES","RJ","SP"],"R. Sudeste":["MG","ES","RJ","SP"],Sul:["RS","PR","SC"],sul:["RS","PR","SC"],"R. Sul":["RS","PR","SC"],"MG/ES":["MG","ES"],"mg/es":["MG","ES"],mg_es:["MG","ES"],"R. MG/ES":["MG","ES"],"Rio de Janeiro":["RJ"],"rio de janeiro":["RJ"],rj:["RJ"],"R. Rio de Janeiro":["RJ"],"São Paulo":["SP"],"são paulo":["SP"],sp:["SP"],"R. São Paulo":["SP"],"Nordeste 1":["CE","PB","RN","MA","PI"],"nordeste 1":["CE","PB","RN","MA","PI"],nordeste_1:["CE","PB","RN","MA","PI"],"R. Nordeste 1":["CE","PB","RN","MA","PI"],"Nordeste 2":["BA","SE","PE","AL"],"nordeste 2":["BA","SE","PE","AL"],nordeste_2:["BA","SE","PE","AL"],"R. Nordeste 2":["BA","SE","PE","AL"],"Sem Regional":[],"sem regional":[]};function P(){const t=C(),i=c(),{data:n,loading:m,error:g}=function(){const[e,a]=s.useState(null),[r,t]=s.useState(!0),[i,n]=s.useState(null),l=s.useCallback(async()=>{t(!0),n(null);try{const e=localStorage.getItem("auth_token");if(!e)throw new Error("Token de autenticação não encontrado");const r=await fetch(`${o}/api/regionals/users`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!r.ok){const e=await r.json().catch(()=>({})),a=(null==e?void 0:e.error)?`${r.status} - ${e.error}`:`${r.status}`;throw new Error(`Erro ao buscar usuários: ${a}`)}const s=await r.json(),t=s.users||s,i={lideresRegionais:0,coordenadores:0,consultores:0,totalMembros:0,totalNacional:0};Array.isArray(t)&&(t.forEach(e=>{var a,r,s,o,t;if(e.funcao)switch(e.funcao.toLowerCase()){case"líder regional":case"lider regional":i.lideresRegionais++;break;case"coordenador":i.coordenadores++;break;case"consultor":"nacional"!==(null==(a=e.regional)?void 0:a.toLowerCase())&&"nacional"!==(null==(r=e.area)?void 0:r.toLowerCase())&&i.consultores++;break;case"nacional":case"líder nacional":case"lider nacional":case"diretor operações":case"diretor operacoes":i.totalNacional++}if("nacional"===(null==(s=e.regional)?void 0:s.toLowerCase())||"nacional"===(null==(o=e.area)?void 0:o.toLowerCase())){const a=null==(t=e.funcao)?void 0:t.toLowerCase();"nacional"!==a&&"líder nacional"!==a&&"lider nacional"!==a&&"diretor operações"!==a&&"diretor operacoes"!==a&&i.totalNacional++}}),i.totalMembros=t.length),a(i)}catch(e){n(e instanceof Error?e.message:"Erro desconhecido")}finally{t(!1)}},[]);return s.useEffect(()=>{localStorage.getItem("auth_token")?l():(t(!1),n("Usuário não autenticado"))},[l]),{data:e,loading:r,error:i,refetch:l}}(),{data:u,loading:x,error:b}=l(),[p,v]=s.useState(!1),[P,M]=s.useState(""),[_,k]=s.useState(!1),[B,L]=s.useState({type:"success",title:"",message:""}),O=e=>{switch(e.toLowerCase()){case"centro-oeste":return"centro_oeste";case"mg/es":return"mg_es";case"nordeste 1":return"nordeste_1";case"nordeste 2":return"nordeste_2";case"rio de janeiro":return"rj";case"são paulo":return"sp";default:return e.toLowerCase().replace(/\s+/g,"_")}},I=[...(u||[]).map(e=>{const a=(e=>{if(!e)return[];const a=e.toLowerCase().trim();return E[a]||E[e]||[]})(e.regional),r=e.liderRegional||(!e.liderNacional||"Nacional"!==e.regional&&"Comercial"!==e.regional?null:e.liderNacional);return"Centro-Oeste"===e.regional||e.regional,{id:e.regional,name:e.regional,states:a,leader:r?{name:r.nome,role:r.funcao}:void 0,coordinator:e.coordenadores.length>0?{name:e.coordenadores[0].nome,role:e.coordenadores[0].funcao}:void 0,consultants:e.consultores.map(e=>({name:e.nome,role:e.funcao})),allMembers:"Nacional"===e.regional?e.coordenadores.map(e=>({name:e.nome,role:e.funcao})):void 0,totalMembers:e.totalMembros,color:A[e.regional]||"bg-slate-50 border-slate-200"}}).filter(e=>"Comercial"!==e.name&&"Comercial"!==e.id&&"comercial"!==e.id)].sort((e,a)=>"Nacional"===e.name?-1:"Nacional"===a.name?1:"R. Centro-Oeste"===e.name||"Centro-Oeste"===e.name?-1:"R. Centro-Oeste"===a.name||"Centro-Oeste"===a.name?1:0);null==n||n.lideresRegionais,null==n||n.coordenadores,null==n||n.totalMembros,null==n||n.totalNacional;const D=g||b;return m||x?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-lg text-gray-600",children:"Carregando dados regionais..."})}):D?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(f,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("div",{className:"text-lg text-red-600 mb-2",children:"Erro ao carregar dados"}),e.jsx("div",{className:"text-sm text-gray-600",children:g||b})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-lg font-bold text-gray-900 mb-2",children:"Regionais"}),e.jsx("p",{className:"text-gray-600",children:"Gestão das 8 Regionais e Equipes"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:I.map(s=>{return e.jsxs(a,{className:`p-6 ${A[s.id]||"bg-slate-50 border-slate-200"} hover:shadow-xl hover:scale-105 hover:border-opacity-80 transition-all duration-300 cursor-pointer`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 rounded-full mr-3 shadow-sm",style:{backgroundColor:(o=s.id,{Nacional:"#3B82F6",Comercial:"#10B981","Centro-Oeste":"#8B5CF6",Norte:"#14B8A6",Nordeste:"#7C3AED",Sudeste:"#059669",Sul:"#4F46E5","MG/ES":"#65A30D","Rio de Janeiro":"#0891B2","São Paulo":"#E11D48","Nordeste 1":"#F59E0B","Nordeste 2":"#EA580C","R. Centro-Oeste":"#8B5CF6","R. Norte":"#14B8A6","R. Nordeste":"#7C3AED","R. Sudeste":"#059669","R. Sul":"#4F46E5","R. MG/ES":"#65A30D","R. Rio de Janeiro":"#0891B2","R. São Paulo":"#E11D48","R. Nordeste 1":"#F59E0B","R. Nordeste 2":"#EA580C",nacional:"#3B82F6",comercial:"#10B981","centro-oeste":"#8B5CF6",centro_oeste:"#8B5CF6",norte:"#14B8A6",nordeste:"#7C3AED",sudeste:"#059669",sul:"#4F46E5","mg/es":"#65A30D",mg_es:"#65A30D","rio de janeiro":"#0891B2",rj:"#0891B2","são paulo":"#E11D48",sp:"#E11D48","nordeste 1":"#F59E0B",nordeste_1:"#F59E0B","nordeste 2":"#EA580C",nordeste_2:"#EA580C","Sem Regional":"#6B7280","sem regional":"#6B7280"}[o]||"#6B7280")}}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:s.name})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:s.totalMembers}),e.jsx("p",{className:"text-sm text-gray-600",children:"membros"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Estados:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.states.map(a=>e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded-full",children:a},a))})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[s.leader&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{className:"h-4 w-4 text-yellow-500 mr-2"}),e.jsxs("span",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Líder Regional:"})," ",s.leader.name]})]}),("Centro-Oeste"===s.name||"R. Centro-Oeste"===s.name)&&e.jsx(e.Fragment,{children:null}),"Nacional"===s.name&&s.allMembers&&s.allMembers.length>0?e.jsxs("div",{className:"flex items-start",children:[e.jsx(N,{className:"h-4 w-4 text-blue-500 mr-2 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Membros:"}),e.jsx("div",{className:"mt-1",children:s.allMembers.map((a,r)=>e.jsxs("span",{className:"block text-gray-600",children:["• ",a.name]},r))})]})]}):e.jsxs(e.Fragment,{children:[s.coordinator&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(N,{className:"h-4 w-4 text-blue-500 mr-2"}),e.jsxs("span",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Coordenador:"})," ",s.coordinator.name]})]}),s.consultants&&s.consultants.length>0&&e.jsxs("div",{className:"flex items-start",children:[e.jsx(y,{className:"h-4 w-4 text-green-500 mr-2 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Consultores:"}),e.jsx("div",{className:"mt-1",children:s.consultants.map((a,r)=>e.jsxs("span",{className:"block text-gray-600",children:["• ",a.name]},r))})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{className:"w-full bg-green-600 hover:bg-green-700 text-white text-sm py-2",size:"sm",onClick:()=>(e=>{M(O(e)),v(!0)})(s.id),children:[e.jsx(S,{className:"h-4 w-4 mr-1"}),"Registrar Atividade"]}),e.jsxs(r,{className:"w-full bg-blue-600 hover:bg-blue-700 text-white text-sm py-2",size:"sm",onClick:()=>t(`/regionais/gestao-atividades?regional=${O(s.id)}`),children:[e.jsx(h,{className:"h-4 w-4 mr-1"}),"Todas as Atividades"]}),e.jsxs(r,{className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white text-sm py-2",size:"sm",onClick:()=>t(`/regionais/calendario?regional=${s.id}`),children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),"Calendário Atividades"]})]})]},s.id);var o})}),e.jsx(w,{isOpen:p,onClose:()=>{v(!1),M("")},onSubmit:async e=>{try{const r=localStorage.getItem("auth_token");if(!r)return;const s=new FormData,t={title:"OUTRA"===e.atividadeLabel&&e.atividadeCustomLabel.trim()?e.atividadeCustomLabel.trim():e.atividadeLabel||e.atividade,description:e.descricao||"",type:e.atividade,activity_date:e.dataAtividade,responsavel_id:e.responsavel||null,regional:"nps"===e.atividade&&e.regionaisNPS&&e.regionaisNPS.length>0?e.regionaisNPS[0]:P||e.regional,programa:e.programa||"",estados:e.estados||[],instituicaoId:e.instituicaoId||"",quantidade:e.quantidade||null,atividadeLabel:e.atividadeLabel||"",atividadeCustomLabel:e.atividadeCustomLabel||"",regionaisNPS:"nps"===e.atividade&&e.regionaisNPS||[]};if(Object.keys(t).forEach(e=>{const a=t[e];null!=a&&(Array.isArray(a)?s.append(e,JSON.stringify(a)):s.append(e,String(a)))}),e.evidencias&&e.evidencias.length>0)for(const o of e.evidencias)if(o.url&&o.url.startsWith("data:"))try{const e=await fetch(o.url),a=await e.blob(),r=new File([a],o.filename,{type:o.mimeType});s.append("evidencias",r)}catch(a){}const n=await fetch(`${o}/api/regional-activities`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:s});if(!n.ok){const e=await n.json();throw new Error(e.error||`Erro ${n.status}: ${n.statusText}`)}await n.json();i.invalidateQueries({queryKey:["regional-activities"]}),i.refetchQueries({queryKey:["regional-activities"]}),v(!1),M(""),L({type:"success",title:"Sucesso!",message:"Atividade registrada com sucesso!"}),k(!0)}catch(a){L({type:"error",title:"Erro ao registrar atividade",message:"Não foi possível registrar a atividade. Tente novamente."}),k(!0)}},regionalId:P}),e.jsx(d,{isOpen:_,onClose:()=>k(!1),type:B.type,title:B.title,message:B.message})]})}export{P as default};
