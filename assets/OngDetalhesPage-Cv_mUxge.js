import{j as e}from"./ui-C_BmRRy8.js";import{r as s}from"./vendor-Psgnp9ei.js";import{C as a}from"./Card-C21MRrmW.js";import{B as t}from"./Button-DjYkO9ZW.js";import{g as r,I as i,A as n}from"./index-_MdAt-zn.js";import{d as c,a as l}from"./router-DVMx2JKX.js";import{v as o,B as d,w as m,J as x,M as p,a0 as h,a1 as j,k as g,Z as u,e as N,Q as f,b as v}from"./icons-sb5RvF5O.js";import"./query-BI71cv7L.js";import"./supabase-CfsjXCJe.js";import"./forms-BADiA78i.js";import"./utils-CwAUyRUs.js";import"./charts-C4lFoNLr.js";function y(){const{id:y}=c(),b=l(),[w,C]=s.useState(null),[D,$]=s.useState(!0),[E,k]=s.useState(!1),z=s.useRef(null),{showError:B,showSuccess:P}=r();s.useEffect(()=>{y&&S()},[y]);const S=async()=>{try{$(!0);const e=await i.getInstituicaoById(y);C(e)}catch(e){B("Erro ao carregar dados da ONG"),b("/ongs")}finally{$(!1)}};return D?e.jsx("div",{className:"p-6 flex items-center justify-center",children:e.jsx("div",{className:"text-gray-500",children:"Carregando dados da ONG..."})}):w?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>b("/ongs"),className:"p-2",children:e.jsx(o,{className:"h-4 w-4"})}),e.jsx(d,{className:"h-6 w-6 text-pink-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:w.nome}),e.jsx("p",{className:"text-sm text-gray-600",children:"Detalhes da Instituição"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(O=w.status,e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${{ativa:"bg-green-100 text-green-800",inativa:"bg-gray-100 text-gray-800",evadida:"bg-red-100 text-red-800"}[O]||"bg-gray-100 text-gray-800"}`,children:{ativa:"Ativa",inativa:"Inativa",evadida:"Evadida"}[O]||O})),e.jsxs(t,{onClick:()=>b(`/ongs/editar/${y}`,{state:{ong:w}}),className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(m,{className:"h-4 w-4 mr-2"}),"Editar"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(a,{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Informações Básicas"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(d,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Nome"}),e.jsx("p",{className:"font-medium",children:w.nome})]})]}),w.cnpj&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"CNPJ"}),e.jsx("p",{className:"font-medium",children:w.cnpj})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(p,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Localização"}),e.jsxs("p",{className:"font-medium",children:[w.cidade,", ",w.estado]})]})]}),w.telefone&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Telefone"}),e.jsx("p",{className:"font-medium",children:w.telefone})]})]}),w.email&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"E-mail"}),e.jsx("p",{className:"font-medium",children:w.email})]})]}),w.nome_lider&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Líder"}),e.jsx("p",{className:"font-medium",children:w.nome_lider})]})]})]}),w.endereco&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Endereço Completo"}),e.jsx("p",{className:"font-medium",children:w.endereco}),w.cep&&e.jsxs("p",{className:"text-sm text-gray-500",children:["CEP: ",w.cep]})]}),w.observacoes&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Observações"}),e.jsx("p",{className:"font-medium",children:w.observacoes})]})]}),e.jsxs(a,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(x,{className:"h-5 w-5"}),"Documentos"]}),e.jsxs(t,{size:"sm",onClick:()=>{var e;null==(e=z.current)||e.click()},disabled:E,className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(u,{className:"h-4 w-4 mr-2"}),E?"Enviando...":"Adicionar Documento"]})]}),e.jsx("input",{ref:z,type:"file",accept:".pdf,.jpg,.jpeg,.png,.txt,.doc,.docx",onChange:async e=>{const s=e.target.files;if(!s||0===s.length)return;const a=["application/pdf","image/jpeg","image/png","image/jpg","text/plain","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],t=Array.from(s);for(const i of t){if(!a.includes(i.type))return void B(`Tipo de arquivo não permitido: ${i.name}. Use PDF, JPG, PNG, TXT, DOC ou DOCX.`);if(i.size>10485760)return void B(`Arquivo muito grande: ${i.name}. Máximo 10MB.`)}try{k(!0);const e=new FormData;t.forEach(s=>{e.append("files",s)}),e.append("tipo","documento");const s=await fetch(`${n}/api/instituicoes/${y}/documentos`,{method:"POST",body:e,headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!s.ok){const e=await s.json();throw new Error(e.error||"Erro ao fazer upload")}const a=await s.json();if(a.errors&&a.errors.length>0){const e=a.errors.map(e=>`${e.filename}: ${e.error}`).join("\n");B(`Alguns arquivos falharam:\n${e}`)}a.documentos&&a.documentos.length>0&&P(`${a.documentos.length} documento(s) enviado(s) com sucesso!`),await S(),z.current&&(z.current.value="")}catch(r){B(r instanceof Error?r.message:"Erro ao fazer upload dos documentos")}finally{k(!1)}},multiple:!0,style:{display:"none"}}),(()=>{const s=(w.documentos||[]).filter(e=>!("string"!=typeof e||!e.trim())||"object"==typeof e&&null!==e&&(e.nome||e.nomeOriginal));return s.length>0?e.jsx("div",{className:"space-y-3",children:s.map((s,a)=>{const r="string"==typeof s?s:(null==s?void 0:s.nomeOriginal)||(null==s?void 0:s.nome),i="object"==typeof s?null==s?void 0:s.tipo:"Documento",c="object"==typeof s?null==s?void 0:s.tamanho:null;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:r}),e.jsxs("p",{className:"text-sm text-gray-500",children:[i,c&&` • ${(c/1024/1024).toFixed(2)} MB`]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(t,{size:"sm",variant:"outline",onClick:()=>(e=>{try{const s=`${n}/api/instituicoes/${y}/documentos/${encodeURIComponent(e)}`;window.open(s,"_blank")}catch(s){alert("Erro ao visualizar documento. Tente novamente.")}})(r),className:"text-blue-600 hover:text-blue-700",children:[e.jsx(N,{className:"h-4 w-4 mr-1"}),"Visualizar"]}),e.jsxs(t,{size:"sm",variant:"outline",onClick:()=>(e=>{try{const s=`${n}/api/instituicoes/${y}/documentos/${encodeURIComponent(e)}?download=true`,a=document.createElement("a");a.href=s,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(s){alert("Erro ao baixar documento. Tente novamente.")}})(r),className:"text-green-600 hover:text-green-700",children:[e.jsx(f,{className:"h-4 w-4 mr-1"}),"Download"]})]})]},a)})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(x,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"Nenhum documento anexado"}),e.jsx("p",{className:"text-sm mt-1",children:'Clique em "Adicionar Documento" para enviar arquivos'})]})})()]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(a,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Programa"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Programa"}),e.jsx("p",{className:"font-medium",children:(I=w.programa,{as_maras:"As Maras",microcredito:"Microcrédito",decolagem:"Decolagem"}[I]||I)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Regional"}),e.jsx("p",{className:"font-medium",children:(A=w.regional,{nacional:"Nacional",sp:"São Paulo",rj:"Rio de Janeiro",mg:"Minas Gerais",rs:"Rio Grande do Sul",pr:"Paraná",sc:"Santa Catarina",ba:"Bahia",pe:"Pernambuco",ce:"Ceará",go:"Goiás",df:"Distrito Federal"}[A]||A)})]})]})]}),e.jsxs(a,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(v,{className:"h-5 w-5"}),"Informações de Data"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Data de Cadastro"}),e.jsx("p",{className:"font-medium",children:w.created_at?new Date(w.created_at).toLocaleDateString("pt-BR"):"Não informado"})]}),w.updated_at&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Última Atualização"}),e.jsx("p",{className:"font-medium",children:new Date(w.updated_at).toLocaleDateString("pt-BR")})]})]})]})]})]})]}):e.jsx("div",{className:"p-6 flex items-center justify-center",children:e.jsx("div",{className:"text-gray-500",children:"ONG não encontrada"})});var A,I,O}export{y as default};
