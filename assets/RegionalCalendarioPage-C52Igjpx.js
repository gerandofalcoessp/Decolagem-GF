import{j as e}from"./ui-C_BmRRy8.js";import{r as s}from"./vendor-Psgnp9ei.js";import{C as a}from"./Card-D0NYs6mj.js";import{B as r}from"./Button-DPj5z5IW.js";import{A as t,R as n}from"./constants-CdNJpgjE.js";import{b as i,f as o,g as l,e as d}from"./index-3h40CfT8.js";import{s as c,X as m,u,v as x,t as g,b as p,w as v,x as h}from"./icons-sb5RvF5O.js";import{C as f}from"./ConfirmModal-BdOhnfXN.js";import{C as j,M as b}from"./MonthGrid-BmLISOxp.js";import{u as y,a as N}from"./router-DVMx2JKX.js";import{s as w,e as _,a as E,g as C,f as M,b as S,d as $}from"./utils-CwAUyRUs.js";import"./query-BI71cv7L.js";import"./supabase-CfsjXCJe.js";import"./forms-BADiA78i.js";import"./charts-C4lFoNLr.js";import"./index-Bn5au-xE.js";function k({isOpen:a,onClose:n,onSubmit:o,form:l,setForm:d,regionalId:x,regionalLabel:g,editingEvent:p}){const v=s.useRef(null),h=s.useRef(null),f=s.useRef(null),j=s.useRef(null),b=s.useRef(null),y=s.useRef(null),N=s.useRef(null),{data:w=[]}=i();s.useEffect(()=>{if(a){v.current&&v.current.value!==l.atividade&&(v.current.value=l.atividade),h.current&&h.current.value!==l.responsavel&&(h.current.value=l.responsavel),f.current&&f.current.value!==l.descricao&&(f.current.value=l.descricao);const e=(e=>{if(!e)return"";if(e.includes("/")){const[s,a,r]=e.split("/");return`${r}-${a.padStart(2,"0")}-${s.padStart(2,"0")}`}return e})(l.data);j.current&&j.current.value!==e&&(j.current.value=e),b.current&&b.current.value!==l.hora&&(b.current.value=l.hora)}},[a,l.atividade,l.responsavel,l.descricao,l.data,l.hora]);const _=()=>{var e,s,a,r,t;const n={atividade:(null==(e=v.current)?void 0:e.value)||"",responsavel:(null==(s=h.current)?void 0:s.value)||"",descricao:(null==(a=f.current)?void 0:a.value)||"",data:(null==(r=j.current)?void 0:r.value)?(()=>{const e=j.current.value,[s,a,r]=e.split("-");return`${r}/${a}/${s}`})():"",hora:(null==(t=b.current)?void 0:t.value)||""};d(n)};s.useEffect(()=>{a&&(N.current=document.activeElement,setTimeout(()=>{var e;return null==(e=v.current)?void 0:e.focus()},100));const e=e=>{"Escape"===e.key&&n()};return a&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset",N.current&&N.current.focus()}},[a,n]);return a?e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-[2px] flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-label":"Novo Evento",children:e.jsxs("div",{ref:y,className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto border border-gray-100",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-indigo-50 to-blue-50 rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-xl",children:e.jsx(c,{className:"w-6 h-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:p?"Editar Evento":"Novo Evento"}),e.jsx("p",{className:"text-sm text-gray-600",children:g})]})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-white/50 rounded-xl transition-colors","aria-label":"Fechar modal",children:e.jsx(m,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("form",{onSubmit:e=>{var s,a,r,t,n;e.preventDefault(),_();const i={atividade:(null==(s=v.current)?void 0:s.value)||"",responsavel:(null==(a=h.current)?void 0:a.value)||"",descricao:(null==(r=f.current)?void 0:r.value)||"",data:(null==(t=j.current)?void 0:t.value)?(()=>{const e=j.current.value,[s,a,r]=e.split("-");return`${r}/${a}/${s}`})():"",hora:(null==(n=b.current)?void 0:n.value)||""};i.atividade&&i.data&&o(i)},className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Atividade *"}),e.jsxs("select",{ref:v,onChange:_,className:"w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm shadow-sm transition-colors",required:!0,children:[e.jsx("option",{value:"",children:"Selecione uma atividade"}),t.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Responsável"}),e.jsxs("select",{ref:h,onChange:_,className:"w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm shadow-sm transition-colors",children:[e.jsx("option",{value:"",children:"Selecione um responsável"}),w.map(s=>e.jsx("option",{value:s.id,children:s.nome||s.email},s.id))]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Data *"}),e.jsx("input",{ref:j,type:"date",onChange:_,className:"w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm shadow-sm transition-colors",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Hora"}),e.jsxs("div",{className:"relative",children:[e.jsx(u,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{ref:b,type:"time",onChange:_,step:"60",className:"w-full pl-10 border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm shadow-sm transition-colors"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Descrição"}),e.jsx("textarea",{ref:f,onChange:_,className:"w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 shadow-sm transition-colors",rows:4,placeholder:"Descrição detalhada do evento"})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx(r,{type:"button",variant:"outline",onClick:n,className:"px-6 rounded-xl shadow-sm",children:"Cancelar"}),e.jsx(r,{type:"submit",className:"px-6 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl shadow-sm",children:p?"Atualizar Evento":"Criar Evento"})]})]})]})}):null}function D(){const t=y(),i=N(),c=new URLSearchParams(t.search),{user:m}=o(),u=c.get("regional"),D=null==m?void 0:m.regional,T=D?(e=>{if(!e)return"nacional";return{norte:"norte","r. norte":"norte","regional norte":"norte",nordeste:"nordeste_1","nordeste 1":"nordeste_1","r. nordeste 1":"nordeste_1","nordeste 2":"nordeste_2","r. nordeste 2":"nordeste_2","centro-oeste":"centro_oeste","centro oeste":"centro_oeste","r. centro-oeste":"centro_oeste","mg/es":"mg_es","mg es":"mg_es","r. mg/es":"mg_es","minas gerais":"mg_es","espírito santo":"mg_es","rio de janeiro":"rj","r. rio de janeiro":"rj",rj:"rj","são paulo":"sp","r. são paulo":"sp",sp:"sp",sul:"sul","r. sul":"sul",nacional:"nacional",comercial:"comercial"}[e.toLowerCase().trim()]||"nacional"})(D):u??"nacional";let R;R=D&&"nacional"!==D?n[T]||D:n[T]||"Nacional";const[z,L]=s.useState(new Date),[F,H]=s.useState(!1),[q,P]=s.useState([]),[A,B]=s.useState(null),[O,G]=s.useState(!1),[I,V]=s.useState(null),{addNotification:Y}=l(),[U,J]=s.useState({atividade:"",responsavel:"",descricao:"",data:"",hora:""}),{data:K,refetch:Q,createEvent:W,updateEvent:X}=d();s.useEffect(()=>{K&&P(K)},[K]);const Z=()=>{J({atividade:"",responsavel:"",descricao:"",data:"",hora:""}),B(null)},ee=s.useMemo(()=>{const e=w(z),s=_(z),a=E({start:e,end:s}),r=C(e);return[...Array(r).fill(null),...a]},[z]),se=s.useMemo(()=>{const e=z.getMonth(),s=z.getFullYear();return q.filter(a=>{const r=new Date(a.data_inicio);return r.getMonth()===e&&r.getFullYear()===s}).sort((e,s)=>+new Date(e.data_inicio)-+new Date(s.data_inicio))},[q,z]),ae=s.useMemo(()=>{const e={};for(const s of se){const a=M(new Date(s.data_inicio),"yyyy-MM-dd");(e[a]||(e[a]=[])).push(s)}return e},[se]),re=e=>{P(s=>s.filter(s=>s.id!==e))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(r,{variant:"outline",onClick:()=>i("/regionais"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900","aria-label":"Voltar para regionais",children:[e.jsx(x,{className:"h-4 w-4"}),"Voltar"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["Calendário - ",R]}),e.jsx("p",{className:"text-gray-600",children:"Gerencie atividades e eventos da regional"})]})]}),e.jsxs(r,{className:"bg-indigo-600 hover:bg-indigo-700 text-white",onClick:()=>H(!0),"aria-label":"Criar novo evento",children:[e.jsx(g,{className:"h-4 w-4 mr-2","aria-hidden":"true"}),"Novo Evento"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(a,{className:"p-6",children:[e.jsx(j,{currentMonth:z,onPrevMonth:()=>L($(z,1)),onNextMonth:()=>L(S(z,1))}),e.jsx(b,{days:ee,currentMonth:z,eventsByDay:ae,onSelectDate:e=>e&&void 0,dotColorBy:"type"})]}),e.jsxs(a,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"text-lg font-semibold text-gray-900",children:["Eventos do Mês (",se.length,")"]}),e.jsx(p,{className:"w-5 h-5 text-gray-400"})]}),e.jsxs("div",{className:"space-y-4",children:[se.map(s=>{const a=new Date(s.data_inicio),t=s.data_fim?new Date(s.data_fim):null;return e.jsxs("div",{className:"group relative bg-white border border-gray-200 rounded-xl p-5 shadow-sm hover:shadow-md transition-all duration-200 hover:border-indigo-200",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1 group-hover:text-indigo-600 transition-colors",children:s.titulo}),s.regional&&e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500"}),e.jsx("span",{className:"text-sm font-medium text-indigo-600",children:n[s.regional]||s.regional})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(p,{className:"w-4 h-4 text-indigo-500"}),e.jsx("span",{className:"font-medium",children:"Data:"}),e.jsx("span",{className:"px-2 py-1 bg-indigo-50 text-indigo-700 rounded-md font-medium",children:M(a,"dd/MM/yyyy")}),t&&t.getTime()!==a.getTime()&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:"até"}),e.jsx("span",{className:"px-2 py-1 bg-indigo-50 text-indigo-700 rounded-md font-medium",children:M(t,"dd/MM/yyyy")})]})]}),s.responsavel&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-purple-100 flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 rounded bg-purple-500"})}),e.jsx("span",{className:"font-medium",children:"Responsável:"}),e.jsx("span",{className:"capitalize",children:s.responsavel.nome||s.responsavel.email})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-orange-100 flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 rounded bg-orange-500"})}),e.jsx("span",{className:"font-medium",children:"Horário:"}),e.jsx("span",{className:"px-2 py-1 bg-orange-50 text-orange-700 rounded-md font-medium",children:s.data_inicio.includes("T")?s.data_inicio.split("T")[1].substring(0,5):M(new Date(s.data_inicio),"HH:mm")})]}),s.local&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-green-100 flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 rounded bg-green-500"})}),e.jsx("span",{className:"font-medium",children:"Local:"}),e.jsx("span",{children:s.local})]}),s.programa&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-blue-100 flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 rounded bg-blue-500"})}),e.jsx("span",{className:"font-medium",children:"Programa:"}),e.jsx("span",{children:s.programa})]}),(s.participantes_esperados&&s.participantes_esperados>0||s.participantes_confirmados&&s.participantes_confirmados>0)&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-cyan-100 flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 rounded bg-cyan-500"})}),e.jsx("span",{className:"font-medium",children:"Participantes:"}),e.jsxs("div",{className:"flex gap-2",children:[s.participantes_confirmados>0&&e.jsxs("span",{className:"px-2 py-1 bg-green-50 text-green-700 rounded text-xs font-medium",children:[s.participantes_confirmados," confirmados"]}),s.participantes_esperados>0&&e.jsxs("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 rounded text-xs font-medium",children:[s.participantes_esperados," esperados"]})]})]})]}),s.descricao&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:e.jsxs("p",{className:"text-sm text-gray-600 leading-relaxed",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Descrição:"})," ",s.descricao]})}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-4 pt-3 border-t border-gray-100",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>(e=>{var s;const a=new Date(e.data_inicio),r=M(a,"yyyy-MM-dd"),t=M(a,"HH:mm");B(e),J({atividade:e.titulo||"",responsavel:(null==(s=e.responsavel)?void 0:s.id)||"",descricao:e.descricao||"",data:r,hora:t}),H(!0)})(s),className:"flex items-center gap-1 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(v,{className:"w-4 h-4"}),"Editar"]}),e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>{return e=s.id,V(e),void G(!0);var e},className:"flex items-center gap-1 text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(h,{className:"w-4 h-4"}),"Excluir"]})]}),e.jsx("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-indigo-500/5 to-purple-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none"})]},s.id)}),0===se.length&&e.jsx("div",{className:"text-sm text-gray-600",children:"Nenhum evento encontrado para este mês."})]})]})]}),e.jsx(k,{isOpen:F,onClose:()=>{H(!1),Z()},form:U,setForm:J,regionalId:T,regionalLabel:R,editingEvent:A,onSubmit:async e=>{try{const s=(e=>{if(e.includes("/")){const[s,a,r]=e.split("/");return`${r}-${a.padStart(2,"0")}-${s.padStart(2,"0")}`}return e})(e.data),a=e.hora?`${s}T${e.hora}:00`:`${s}T00:00:00`,r=e.hora?`${s}T${e.hora}:00`:`${s}T23:59:59`,t={titulo:e.atividade,descricao:e.descricao,data_inicio:a,data_fim:r,regional:T,responsavel_id:e.responsavel};if(A){await X(A.id,t);await Q(),Y({type:"success",title:"Evento atualizado",message:"Evento atualizado com sucesso!"})}else{await W(t);await Q(),Y({type:"success",title:"Evento criado",message:"Evento criado com sucesso!"})}H(!1),Z()}catch(s){Y({type:"error",title:A?"Erro ao atualizar evento":"Erro ao criar evento",message:s instanceof Error?s.message:"Erro desconhecido"})}}}),e.jsx(f,{isOpen:O,onClose:()=>{G(!1),V(null)},onConfirm:()=>{I&&(re(I),V(null),Y({type:"success",title:"Evento excluído",message:"Evento excluído com sucesso!"}))},title:"Confirmar Exclusão",message:"Tem certeza que deseja excluir este evento? Esta ação não pode ser desfeita.",type:"danger",confirmText:"Excluir",cancelText:"Cancelar"})]})}export{D as default};
