import{j as e}from"./ui-C_BmRRy8.js";import{r as s}from"./vendor-Psgnp9ei.js";import{C as a}from"./Card-D0NYs6mj.js";import{B as t}from"./Button-DPj5z5IW.js";import{g as r,I as i}from"./index-3h40CfT8.js";import{X as o,B as n,t as l,G as c,e as d,w as x,x as m,$ as u}from"./icons-sb5RvF5O.js";import{a as g}from"./router-DVMx2JKX.js";import"./query-BI71cv7L.js";import"./supabase-CfsjXCJe.js";import"./forms-BADiA78i.js";import"./utils-CwAUyRUs.js";import"./charts-C4lFoNLr.js";function p({isOpen:a,onClose:r,onConfirm:i,ongNome:n}){const[l,c]=s.useState(""),[d,x]=s.useState("");if(!a)return null;const m=()=>{c(""),x(""),r()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Registrar Evasão"}),e.jsx("button",{onClick:m,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(o,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Registrar evasão da ONG: ",e.jsx("strong",{children:n})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Motivo da Evasão"}),e.jsx("textarea",{value:l,onChange:e=>c(e.target.value),placeholder:"Descreva o motivo da evasão...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent resize-none",rows:4,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data da Evasão"}),e.jsx("input",{type:"date",value:d,onChange:e=>x(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",required:!0})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 p-4 border-t",children:[e.jsx(t,{variant:"outline",onClick:m,className:"text-gray-700 border-gray-300 hover:bg-gray-50",children:"Cancelar"}),e.jsx(t,{onClick:()=>{l.trim()&&d&&(i(l,d),c(""),x(""))},disabled:!l.trim()||!d,className:"bg-orange-600 hover:bg-orange-700 text-white disabled:opacity-50 disabled:cursor-not-allowed",children:"Registrar Evasão"})]})]})})}function h(){var o;const h=g(),[j,v]=s.useState([]),[f,N]=s.useState(!0),[y,b]=s.useState(""),[w,C]=s.useState("todos"),[k,S]=s.useState("todas"),[E,O]=s.useState("todos"),[_,G]=s.useState({isOpen:!1,ong:null}),{showSuccess:M,showError:R,showConfirmation:I}=r();s.useEffect(()=>{(async()=>{try{N(!0);const e=(await i.getInstituicoes()).map(e=>({id:e.id,nome:e.nome,cnpj:e.cnpj,endereco:e.endereco,cidade:e.cidade,estado:e.estado,cep:e.cep,telefone:e.telefone,email:e.email,regional:e.regional,programa:e.programa,programas:e.programas||[],observacoes:e.observacoes||"",nome_lider:e.nome_lider,documentos:e.documentos||[],created_at:e.created_at,status:e.status}));v(e)}catch(e){R("Erro ao carregar instituições"),v([])}finally{N(!1)}})()},[R]);const z=s.useMemo(()=>j.filter(e=>{const s=!y||e.nome.toLowerCase().includes(y.toLowerCase())||e.cnpj&&e.cnpj.includes(y)||e.cidade&&e.cidade.toLowerCase().includes(y.toLowerCase()),a="todas"===k||e.regional===k,t="todos"===E||e.programa===E,r="todos"===w||e.status===w;return s&&a&&t&&r}),[j,y,k,E,w]),T=e=>({as_maras:"As Maras",microcredito:"Microcrédito",decolagem:"Decolagem"}[e]||e),A=e=>{var s,a,t,r,i,o,n,l;if((null==(s=e.nome)?void 0:s.includes("Wise Madness"))||null==(a=e.nome)||a.includes("Recomeçar"),e.programas&&e.programas.length>0){const s=e.programas.map(e=>T(e)).join(", ");return(null==(t=e.nome)?void 0:t.includes("Wise Madness"))||null==(r=e.nome)||r.includes("Recomeçar"),s}if(e.programa){const s=T(e.programa);return(null==(i=e.nome)?void 0:i.includes("Wise Madness"))||null==(o=e.nome)||o.includes("Recomeçar"),s}return(null==(n=e.nome)?void 0:n.includes("Wise Madness"))||null==(l=e.nome)||l.includes("Recomeçar"),"-"};return f?e.jsx("div",{className:"p-6 flex items-center justify-center",children:e.jsx("div",{className:"text-gray-500",children:"Carregando ONGs..."})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(n,{className:"h-6 w-6 text-pink-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Instituições"})]}),e.jsxs(t,{className:"bg-pink-600 hover:bg-pink-700 text-white",onClick:()=>h("/ongs/cadastrar"),children:[e.jsx(l,{className:"h-4 w-4 mr-2"}),"Nova Instituição"]})]}),e.jsx(a,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx("input",{type:"text",placeholder:"Buscar por nome, CNPJ ou cidade...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",value:y,onChange:e=>b(e.target.value)})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Regional"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",value:k,onChange:e=>S(e.target.value),children:[e.jsx("option",{value:"todas",children:"Todas as Regionais"}),e.jsx("option",{value:"nacional",children:"Nacional"}),e.jsx("option",{value:"comercial",children:"Comercial"}),e.jsx("option",{value:"centro_oeste",children:"Centro-Oeste"}),e.jsx("option",{value:"mg_es",children:"MG/ES"}),e.jsx("option",{value:"nordeste_1",children:"Nordeste 1"}),e.jsx("option",{value:"nordeste_2",children:"Nordeste 2"}),e.jsx("option",{value:"norte",children:"Norte"}),e.jsx("option",{value:"rj",children:"RJ"}),e.jsx("option",{value:"sp",children:"SP"}),e.jsx("option",{value:"sul",children:"Sul"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Programa"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",value:E,onChange:e=>O(e.target.value),children:[e.jsx("option",{value:"todos",children:"Todos os Programas"}),e.jsx("option",{value:"as_maras",children:"As Maras"}),e.jsx("option",{value:"microcredito",children:"Microcrédito"}),e.jsx("option",{value:"decolagem",children:"Decolagem"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",value:w,onChange:e=>C(e.target.value),children:[e.jsx("option",{value:"todos",children:"Todos os Status"}),e.jsx("option",{value:"ativa",children:"Ativas"}),e.jsx("option",{value:"inativa",children:"Inativas"}),e.jsx("option",{value:"evadida",children:"Evadidas"})]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(a,{className:"p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:j.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total de ONGs"})]}),e.jsxs(a,{className:"p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:j.filter(e=>"ativa"===e.status).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"ONGs Ativas"})]}),e.jsxs(a,{className:"p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:j.filter(e=>"inativa"===e.status).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"ONGs Inativas"})]}),e.jsxs(a,{className:"p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:j.filter(e=>"evadida"===e.status).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"ONGs Evadidas"})]})]}),e.jsx(a,{className:"overflow-hidden",children:0===z.length?e.jsx("div",{className:"p-8 text-center text-gray-500",children:0===j.length?"Nenhuma ONG cadastrada":"Nenhuma ONG encontrada com os filtros aplicados"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nome"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Regional"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Programa"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cidade"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ações"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:z.map(s=>{return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.nome}),s.cnpj&&e.jsx("div",{className:"text-sm text-gray-500",children:s.cnpj})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(r=s.regional,{nacional:"Nacional",comercial:"Comercial",centro_oeste:"Centro-Oeste",mg_es:"MG/ES",nordeste_1:"Nordeste 1",nordeste_2:"Nordeste 2",norte:"Norte",rj:"RJ",sp:"SP",sul:"Sul"}[r]||r)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:A(s)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.cidade||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:(a=s.status,e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${{ativa:"bg-green-100 text-green-800",inativa:"bg-gray-100 text-gray-800",evadida:"bg-red-100 text-red-800"}[a]}`,children:{ativa:"Ativa",inativa:"Inativa",evadida:"Evadida"}[a]}))}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{size:"sm",variant:"outline",onClick:()=>h(`/ongs/detalhes/${s.id}`),className:"text-green-600 hover:text-green-700",title:"Ver detalhes",children:e.jsx(d,{className:"h-4 w-4"})}),e.jsx(t,{size:"sm",variant:"outline",onClick:()=>(e=>{h(`/ongs/editar/${e.id}`,{state:{ong:e}})})(s),className:"text-blue-600 hover:text-blue-700",children:e.jsx(x,{className:"h-4 w-4"})}),e.jsx(t,{size:"sm",variant:"destructive",onClick:()=>(async e=>{if(await I({title:"Confirmar exclusão",message:`Tem certeza que deseja excluir a ONG "${e.nome}"?`,onConfirm:()=>{},confirmText:"Excluir",cancelText:"Cancelar"}))try{await i.deleteInstituicao(e.id);const s=j.filter(s=>s.id!==e.id);v(s),M("Instituição excluída com sucesso!")}catch(s){R("Erro ao excluir instituição")}})(s),title:"Excluir instituição",children:e.jsx(m,{className:"h-4 w-4"})}),"ativa"===s.status&&e.jsx(t,{size:"sm",variant:"outline",onClick:()=>(e=>{G({isOpen:!0,ong:e})})(s),className:"text-orange-600 hover:text-orange-700",children:e.jsx(u,{className:"h-4 w-4"})})]})})]},s.id);var a,r})})]})})}),e.jsx(p,{isOpen:_.isOpen,onClose:()=>G({isOpen:!1,ong:null}),onConfirm:async(e,s)=>{if(_.ong)try{await i.marcarEvasao(_.ong.id,{motivo:e,data:s});const a=j.map(a=>a.id===_.ong.id?{...a,status:"evadida",evasao:{motivo:e,data:s,registradoEm:(new Date).toISOString()}}:a);v(a),G({isOpen:!1,ong:null}),M("Evasão registrada com sucesso!")}catch(a){R("Erro ao registrar evasão")}},ongNome:(null==(o=_.ong)?void 0:o.nome)||""})]})}export{h as default};
