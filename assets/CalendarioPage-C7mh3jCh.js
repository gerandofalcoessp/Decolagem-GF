const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-_MdAt-zn.js","assets/ui-C_BmRRy8.js","assets/vendor-Psgnp9ei.js","assets/router-DVMx2JKX.js","assets/query-BI71cv7L.js","assets/supabase-CfsjXCJe.js","assets/icons-sb5RvF5O.js","assets/forms-BADiA78i.js","assets/utils-CwAUyRUs.js","assets/charts-C4lFoNLr.js","assets/index-CAhSAb_o.css"])))=>i.map(i=>d[i]);
import{j as e}from"./ui-C_BmRRy8.js";import{r as a}from"./vendor-Psgnp9ei.js";import{C as s}from"./Card-C21MRrmW.js";import{B as t}from"./Button-DjYkO9ZW.js";import{b as i,s as r,X as n,F as l,t as o}from"./icons-sb5RvF5O.js";import{f as d,s as c,e as m,a as u,g as x,b as g,d as p}from"./utils-CwAUyRUs.js";import{_ as h}from"./supabase-CfsjXCJe.js";import{b as v,L as b,e as f}from"./index-_MdAt-zn.js";import{P as j,b as N,S as y,D as w,R as C,a as S,A as E}from"./constants-CdNJpgjE.js";import{C as A,M as L}from"./MonthGrid-BmLISOxp.js";import"./router-DVMx2JKX.js";import"./query-BI71cv7L.js";import"./forms-BADiA78i.js";import"./charts-C4lFoNLr.js";import"./index-Bn5au-xE.js";function _({selectedRegional:a,selectedDepartamento:t,onChangeRegional:i,onChangeDepartamento:r,eventsOfMonthCount:n,filteredEventsCount:l,REGIONAL_LABELS:o,DEPARTAMENTO_LABELS:d}){return e.jsx(s,{className:"p-4 bg-gradient-to-r from-blue-50 to-purple-50 border-blue-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Regional"}),e.jsx("select",{"aria-label":"Selecionar regional",value:a,onChange:e=>i(e.target.value),className:"w-full border border-gray-300 rounded-lg p-2 bg-white",children:Object.entries(o).map(([a,s])=>e.jsx("option",{value:a,children:s},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Departamento"}),e.jsx("select",{"aria-label":"Selecionar departamento",value:t,onChange:e=>r(e.target.value),className:"w-full border border-gray-300 rounded-lg p-2 bg-white",children:Object.entries(d).map(([a,s])=>e.jsx("option",{value:a,children:s},a))})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("div",{className:"font-medium",children:["Eventos filtrados: ",n]}),e.jsxs("div",{children:["Total de eventos: ",l]})]})})]})})}function D({events:a,onEdit:t,onDelete:r,REGIONAL_LABELS:n}){const l=e=>({Norte:"#3B82F6",Nordeste:"#22C55E","Centro-Oeste":"#FBB928",Sudeste:"#EF4444",Sul:"#A855F7"}[e]||"#9CA3AF");return e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"text-lg font-semibold text-gray-900",children:["Eventos do Mês (",a.length,")"]}),e.jsx(i,{className:"w-5 h-5 text-gray-400"})]}),e.jsxs("div",{className:"space-y-4",children:[a.map(a=>{const s=new Date(a.data_inicio),t=a.data_fim?new Date(a.data_fim):null;return e.jsxs("div",{className:"group relative bg-white border border-gray-200 rounded-xl p-5 shadow-sm hover:shadow-md transition-all duration-200 hover:border-indigo-200",style:{backgroundColor:(r=n[a.regional]||"",{Norte:"rgba(59, 130, 246, 0.1)",Nordeste:"rgba(34, 197, 94, 0.1)","Centro-Oeste":"rgba(251, 191, 36, 0.1)",Sudeste:"rgba(239, 68, 68, 0.1)",Sul:"rgba(168, 85, 247, 0.1)"}[r]||"rgba(156, 163, 175, 0.1)")},children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1 group-hover:text-indigo-600 transition-colors",children:a.titulo}),a.regional&&e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:l(n[a.regional]||"")}}),e.jsx("span",{className:"text-sm font-medium text-indigo-600",children:n[a.regional]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(i,{className:"w-4 h-4 text-indigo-500"}),e.jsx("span",{className:"font-medium",children:"Data:"}),e.jsx("span",{className:"px-2 py-1 bg-indigo-50 text-indigo-700 rounded-md font-medium",children:d(s,"dd/MM/yyyy")}),t&&t.getTime()!==s.getTime()&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:"até"}),e.jsx("span",{className:"px-2 py-1 bg-indigo-50 text-indigo-700 rounded-md font-medium",children:d(t,"dd/MM/yyyy")})]})]}),a.responsavel&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-purple-100 flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 rounded bg-purple-500"})}),e.jsx("span",{className:"font-medium",children:"Responsável:"}),e.jsx("span",{className:"capitalize",children:a.responsavel.nome||a.responsavel.email})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-orange-100 flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 rounded bg-orange-500"})}),e.jsx("span",{className:"font-medium",children:"Horário:"}),e.jsx("span",{className:"px-2 py-1 bg-orange-50 text-orange-700 rounded-md font-medium",children:a.data_inicio.includes("T")?a.data_inicio.split("T")[1].substring(0,5):d(new Date(a.data_inicio),"HH:mm")})]}),a.local&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-green-100 flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 rounded bg-green-500"})}),e.jsx("span",{className:"font-medium",children:"Local:"}),e.jsx("span",{children:a.local})]}),a.programa&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-blue-100 flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 rounded bg-blue-500"})}),e.jsx("span",{className:"font-medium",children:"Programa:"}),e.jsx("span",{children:a.programa})]}),(a.participantes_esperados&&a.participantes_esperados>0||a.participantes_confirmados&&a.participantes_confirmados>0)&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-cyan-100 flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 rounded bg-cyan-500"})}),e.jsx("span",{className:"font-medium",children:"Participantes:"}),e.jsxs("div",{className:"flex gap-2",children:[a.participantes_confirmados>0&&e.jsxs("span",{className:"px-2 py-1 bg-green-50 text-green-700 rounded text-xs font-medium",children:[a.participantes_confirmados," confirmados"]}),a.participantes_esperados>0&&e.jsxs("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 rounded text-xs font-medium",children:[a.participantes_esperados," esperados"]})]})]})]}),a.descricao&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:e.jsxs("p",{className:"text-sm text-gray-600 leading-relaxed",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Descrição:"})," ",a.descricao]})}),e.jsx("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-indigo-500/5 to-purple-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none"})]},a.id);var r}),0===a.length&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(i,{className:"w-16 h-16 text-gray-300 mx-auto mb-4","aria-hidden":"true"}),e.jsx("div",{className:"text-lg font-medium text-gray-500 mb-2",children:"Nenhum evento encontrado"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Ajuste os filtros ou crie um novo evento para começar"})]})]})]})}function k({warning:a}){if(!a||!a.hasConflict)return null;const s=a.details??[];return e.jsxs("div",{role:"alert","aria-live":"polite",className:"mt-3 rounded-md border border-amber-300 bg-amber-50 p-3 text-amber-800",children:[e.jsx("div",{className:"text-sm font-medium",children:a.message}),s.length>0&&e.jsx("ul",{className:"mt-2 list-disc pl-5 text-sm",children:s.map((a,s)=>e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:a.title})," — ",a.range]},s))})]})}function O({isOpen:s,editingId:i,form:l,setForm:o,customTypes:d,setCustomTypes:c,REGIONAL_LABELS:m,ATIVIDADE_OPTIONS:u,onClose:x,onSubmit:g,showRegionalField:p=!0,conflictWarning:f}){const w=a.useRef(null),C=a.useRef(null),S=a.useRef(null),[E,A]=a.useState([]),[L,_]=a.useState(""),D=a.useRef(x);a.useEffect(()=>{D.current=x},[x]);const{data:O,loading:I,error:R}=v(),M={nacional:["nacional"],comercial:["comercial"],centro_oeste:["centrooeste"],mg_es:["mges"],nordeste_1:["nordeste1"],nordeste_2:["nordeste2"],norte:["norte"],rj:["rj","riodejaneiro"],sp:["sp","saopaulo"],sul:["sul"]},T=(O||[]).filter(e=>{if(!e.id||"string"!=typeof e.id||""===e.id.trim())return!1;const a=(e.area||e.regional||""||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]/g,"").trim();const s=(M[l.regional]||[]).some(e=>a.includes(e)),t="nacional"===a;return"nacional"===l.regional?s||t:s}).sort((e,a)=>(e.nome||e.email||"").localeCompare(a.nome||a.email||""));return a.useEffect(()=>{if(!s)return;(async()=>{try{const{InstituicaoService:e}=await h(async()=>{const{InstituicaoService:e}=await import("./index-_MdAt-zn.js").then(e=>e.p);return{InstituicaoService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])),a=(await e.getInstituicoes()).map(e=>({id:e.id,nome:e.nome})).filter(e=>e.id&&e.nome);A(a)}catch(e){A([])}})()},[s]),a.useEffect(()=>{s&&w.current&&w.current.focus()},[s]),a.useEffect(()=>{if(!s)return;S.current=document.activeElement;const e=e=>{var a;if("Escape"===e.key)return e.preventDefault(),void(null==(a=D.current)||a.call(D));if("Tab"===e.key&&C.current){const a=C.current.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex]:not([tabindex="-1"])');if(!a.length)return;const s=a[0],t=a[a.length-1],i=document.activeElement;e.shiftKey?i===s&&(e.preventDefault(),t.focus()):i===t&&(e.preventDefault(),s.focus())}};return document.addEventListener("keydown",e),()=>{var a;document.removeEventListener("keydown",e),null==(a=S.current)||a.focus()}},[s]),s?e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-[2px] flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-label":i?"Editar Evento":"Novo Evento",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-3xl max-h-[90vh] overflow-y-auto shadow-2xl ring-1 ring-gray-200",ref:C,tabIndex:-1,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(r,{className:"w-6 h-6 text-pink-500","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 leading-tight",children:i?"Editar Evento":"Novo Evento"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Preencha os detalhes abaixo"})]})]}),e.jsx("button",{"aria-label":"Fechar modal",className:"p-2 rounded-xl hover:bg-gray-100 transition-colors",onClick:x,children:e.jsx(n,{className:"w-5 h-5","aria-hidden":"true"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Atividade *"}),e.jsxs("select",{ref:w,"aria-label":"Selecionar atividade",value:l.atividade||"",onChange:e=>{var a;const s=e.target.value,t=(null==(a=e.target.options[e.target.selectedIndex])?void 0:a.text)||"";o({...l,atividade:s,atividadeLabel:t})},className:"w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm shadow-sm transition-colors",children:[e.jsx("option",{value:"",children:"Selecione uma atividade"}),[...u.filter(e=>"OUTRA"!==e.label),...d,{value:"outros",label:"OUTRA"}].map(a=>e.jsx("option",{value:a.value,children:a.label},`${a.value}-${a.label}`))]}),"OUTRA"===l.atividadeLabel&&e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx("input",{type:"text","aria-label":"Nome da nova atividade",value:l.atividadeCustomLabel,onChange:e=>o({...l,atividadeCustomLabel:e.target.value}),className:"flex-1 border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm shadow-sm transition-colors",placeholder:"Nome da nova atividade"}),e.jsx(t,{variant:"outline",onClick:()=>{const e=l.atividadeCustomLabel.trim();e&&(c([...d,{value:"outros",label:e}]),o({...l,atividadeLabel:e}))},className:"whitespace-nowrap rounded-xl shadow-sm",children:"Salvar no filtro"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Programa *"}),e.jsxs("select",{"aria-label":"Selecionar programa",value:l.programa||"",onChange:e=>o({...l,programa:e.target.value}),className:"w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm shadow-sm transition-colors",children:[e.jsx("option",{value:"",children:"Selecione um programa"}),Object.entries(j).map(([a,s])=>e.jsx("option",{value:a,children:s},a))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Quantidade"}),e.jsx("input",{type:"number",min:0,step:1,"aria-label":"Quantidade",value:"number"==typeof l.quantidade?l.quantidade:"",onChange:e=>{const a=e.target.value,s=""===a?void 0:Math.max(0,Math.floor(Number(a)));o({...l,quantidade:s})},className:"w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 shadow-sm transition-colors",placeholder:"Informe a quantidade (opcional)"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Use para contabilizar itens como pessoas atendidas, encontros realizados, etc."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Instituição"}),e.jsxs("select",{"aria-label":"Selecionar instituição",value:l.instituicaoId||"",onChange:e=>o({...l,instituicaoId:e.target.value}),className:"w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 shadow-sm transition-colors",children:[e.jsx("option",{value:"",children:"Selecione uma instituição"}),E.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:'Lista exibe ONGs cadastradas na página "Cadastrar ONG".'})]})]}),p&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Regional *"}),e.jsx("select",{"aria-label":"Selecionar regional",value:l.regional,onChange:e=>o({...l,regional:e.target.value}),className:"w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm shadow-sm transition-colors",children:Object.entries(m).filter(([e])=>"todas"!==e).map(([a,s])=>e.jsx("option",{value:a,children:s},a))})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Responsável"}),e.jsxs("select",{"aria-label":"Selecionar responsável",value:l.responsavel,onChange:e=>o({...l,responsavel:e.target.value}),className:"w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm shadow-sm transition-colors",children:[e.jsx("option",{value:"",children:"Nenhum responsável"}),I&&e.jsx("option",{disabled:!0,children:"Carregando usuários..."}),!I&&R&&e.jsx("option",{disabled:!0,children:"Erro ao carregar usuários"}),!I&&!R&&T.map(a=>{var s;const t=a.nome||(null==(s=a.email)?void 0:s.split("@")[0])||"Usuário";return e.jsx("option",{value:a.id,children:t},a.id)})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Data da Atividade *"}),e.jsx("input",{type:"date","aria-label":"Data da atividade",value:l.dataAtividade,onChange:e=>{o({...l,dataAtividade:e.target.value})},className:"w-full md:max-w-[220px] border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm shadow-sm transition-colors",placeholder:"dd/mm/yyyy"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Estado(s)"}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Filtro por UF da regional"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50",onClick:()=>{const e=N[l.regional]||[];o({...l,estados:e})},children:"Selecionar todos"}),e.jsx("button",{type:"button",className:"text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50",onClick:()=>o({...l,estados:[]}),children:"Limpar"})]})]}),e.jsx("div",{"aria-label":"Selecionar estados",className:"w-full border border-gray-300 rounded-xl p-3 focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-blue-500 max-h-40 overflow-y-auto bg-white shadow-sm",children:(N[l.regional]||[]).map(a=>e.jsxs("label",{className:"flex items-center gap-2 py-1",children:[e.jsx("input",{type:"checkbox","aria-label":`Selecionar estado ${a}`,checked:l.estados.includes(a),onChange:e=>{const s=e.target.checked,t={...l,estados:s?Array.from(new Set([...l.estados,a])):l.estados.filter(e=>e!==a)};o(t)},className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm text-gray-700",children:[y[a]||a," (",a,")"]})]},a))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Marque as caixas para selecionar múltiplos estados."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Descrição"}),e.jsx("textarea",{"aria-label":"Descrição do evento",value:l.descricao,onChange:e=>o({...l,descricao:e.target.value}),className:"w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 shadow-sm transition-colors",rows:3,placeholder:"Descrição detalhada do evento"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Evidências"}),e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Adicione até 2 fotos como evidência da atividade realizada (JPG, JPEG, PNG, WebP · máx. 5MB cada)."}),e.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",multiple:!0,onChange:e=>(async e=>{if(!e)return;const a=["image/jpeg","image/jpg","image/png","image/webp"],s=2-(l.evidencias||[]).length,t=Array.from(e).slice(0,Math.max(0,s));if(t.find(e=>!a.includes(e.type)||e.size>5242880))return void _("Formato inválido ou arquivo maior que 5MB. Aceitos: JPG, JPEG, PNG, WebP.");_("");const i=e=>new Promise((a,s)=>{const t=new FileReader;t.onload=()=>a(t.result),t.onerror=s,t.readAsDataURL(e)}),r=[];for(const l of t){const e=await i(l);r.push({id:`${l.name}-${Date.now()}`,filename:l.name,mimeType:l.type,size:l.size,url:e,created_at:(new Date).toISOString()})}const n=l.evidencias||[];o({...l,evidencias:[...n,...r].slice(0,2)})})(e.target.files),className:"block w-full text-sm text-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-pink-50 file:text-pink-700 hover:file:bg-pink-100"}),L&&e.jsx("p",{className:"text-xs text-red-600 mt-2",children:L}),l.evidencias&&l.evidencias.length>0&&e.jsx("div",{className:"mt-3 grid grid-cols-2 gap-3",children:l.evidencias.slice(0,2).map(a=>e.jsxs("div",{className:"border rounded-xl p-2 flex items-center space-x-2",children:[a.url?e.jsx(b,{src:a.url,alt:a.filename,className:"w-16 h-16 object-cover rounded-md",width:64,height:64}):e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-md"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-800 truncate",children:a.filename}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(a.size/1048576).toFixed(2)," MB"]})]}),e.jsx(t,{variant:"destructive",onClick:()=>{return e=a.id,void o({...l,evidencias:(l.evidencias||[]).filter(a=>a.id!==e)});var e},className:"rounded-md",children:"Remover"})]},a.id))})]}),f&&e.jsx(k,{warning:f}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx(t,{variant:"outline",onClick:x,className:"px-6 rounded-xl shadow-sm",children:"Cancelar"}),e.jsx(t,{onClick:g,className:"px-6 bg-pink-500 hover:bg-pink-600 text-white rounded-xl shadow-sm",disabled:!(l.atividade&&l.dataAtividade&&l.regional&&l.programa),"aria-disabled":!(l.atividade&&l.dataAtividade&&l.regional&&l.programa),children:i?"Salvar Alterações":"Criar Evento"})]})]})}):null}function I(){const[i,r]=a.useState(new Date),[n,h]=a.useState(!1),[v,b]=a.useState(null),[j,N]=a.useState([]),[y,k]=a.useState([]),[I,R]=a.useState("todas"),[M,T]=a.useState("todos"),[F,P]=a.useState(!1),{data:q}=f(!0);a.useEffect(()=>{q&&N(q)},[q]);const B=a.useMemo(()=>{const e=c(i),a=m(i),s=u({start:e,end:a}),t=x(e);return[...Array(t).fill(null),...s]},[i]),G=a.useMemo(()=>j.filter(e=>{const a="todas"===I||e.regional===I,s="todos"===M||"regionais"===M&&!["nacional","comercial"].includes(e.regional)||"comercial"===M&&"comercial"===e.regional||"nacional"===M&&"nacional"===e.regional;return a&&s}),[j,I,M]),z=a.useMemo(()=>{const e=i.getMonth(),a=i.getFullYear();return G.filter(s=>{const t=new Date(s.data_inicio);return t.getMonth()===e&&t.getFullYear()===a}).sort((e,a)=>+new Date(e.data_inicio)-+new Date(a.data_inicio))},[G,i]),U=a.useMemo(()=>{const e={};for(const a of z){const s=d(new Date(a.data_inicio),"yyyy-MM-dd");(e[s]||(e[s]=[])).push(a)}return e},[z]),[$,J]=a.useState({atividade:"",atividadeLabel:"",atividadeCustomLabel:"",responsavel:"",descricao:"",dataAtividade:"",regional:"nacional",local:"",estados:[],programa:"",instituicaoId:"",evidencias:[],quantidade:void 0});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"Calendário Global"}),e.jsx("p",{className:"text-gray-600",children:"Visualize e gerencie eventos de todas as regionais, comercial e nacional"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(t,{variant:"outline",onClick:()=>P(!F),className:"flex items-center space-x-2",children:[e.jsx(l,{className:"w-4 h-4"}),e.jsx("span",{children:"Filtros"})]}),e.jsxs(t,{onClick:()=>{b(null),J({atividade:"",atividadeLabel:"",atividadeCustomLabel:"",responsavel:"",descricao:"",dataAtividade:"",regional:"nacional",local:"",estados:[],programa:"",instituicaoId:"",evidencias:[],quantidade:void 0}),h(!0)},className:"bg-pink-500 hover:bg-pink-600 text-white",children:[e.jsx(o,{className:"h-4 w-4 mr-2"}),"Novo Evento"]})]})]}),F&&e.jsx(_,{selectedRegional:I,selectedDepartamento:M,onChangeRegional:e=>R(e),onChangeDepartamento:e=>T(e),eventsOfMonthCount:z.length,filteredEventsCount:G.length,REGIONAL_LABELS:C,DEPARTAMENTO_LABELS:w}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[e.jsxs(s,{className:"xl:col-span-2 p-6 bg-gradient-to-br from-white to-gray-50",children:[e.jsx(A,{currentMonth:i,onPrevMonth:()=>r(p(i,1)),onNextMonth:()=>r(g(i,1))}),e.jsx(L,{days:B,currentMonth:i,eventsByDay:U,onSelectDate:()=>{},dotColorBy:"regional"}),e.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"Legenda por Regional"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 text-xs",children:Object.entries(C).map(([a,s])=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${S[a]||"bg-gray-400"}`}),e.jsx("span",{className:"text-gray-600",children:s})]},a))})]})]}),e.jsx(D,{events:z,onEdit:e=>{var a;b(e.id);const s=new Date(e.data_inicio),t=[...E,...y].find(a=>a.label===e.titulo);J({atividade:(null==t?void 0:t.value)??e.tipo,atividadeLabel:e.titulo,atividadeCustomLabel:"",responsavel:(null==(a=e.responsavel)?void 0:a.nome)??"",descricao:e.descricao??"",dataAtividade:d(s,"yyyy-MM-dd"),regional:e.regional??"nacional",local:e.local??"",estados:[],programa:e.programa??"",instituicaoId:"",evidencias:e.evidencias||[],quantidade:e.quantidade}),h(!0)},onDelete:e=>{N(a=>a.filter(a=>a.id!==e))},REGIONAL_LABELS:C,REGIONAL_COLOR_CLASSES:S})]}),n&&e.jsx(O,{isOpen:n,editingId:v,form:$,setForm:J,customTypes:y,setCustomTypes:k,REGIONAL_LABELS:C,ATIVIDADE_OPTIONS:E,onClose:()=>h(!1),onSubmit:()=>{var e;if(!$.atividade||!$.dataAtividade||!$.regional)return;const a=new Date(`${$.dataAtividade}T00:00:00`).toISOString(),s=$.atividadeLabel||(null==(e=E.find(e=>e.value===$.atividade))?void 0:e.label)||"Novo Evento",t="OUTRA"===s&&$.atividadeCustomLabel.trim()?$.atividadeCustomLabel.trim():s;if(v)N(e=>e.map(e=>e.id===v?{...e,titulo:t,tipo:$.atividade,descricao:$.descricao,data_inicio:a,data_fim:void 0,regional:$.regional,local:$.local,programa:$.programa||void 0,evidencias:$.evidencias,quantidade:$.quantidade,updated_at:(new Date).toISOString()}:e));else{const e={id:`evt-${Date.now()}`,titulo:t,descricao:$.descricao,tipo:$.atividade,data_inicio:a,data_fim:void 0,local:$.local||void 0,regional:$.regional,programa:$.programa||"decolagem",participantes_confirmados:0,status:"ativo",evidencias:$.evidencias,quantidade:$.quantidade,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};N(a=>[...a,e])}h(!1)}})]})}export{I as default};
