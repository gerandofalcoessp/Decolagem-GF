import{j as e}from"./ui-C_BmRRy8.js";import{r as t}from"./vendor-Psgnp9ei.js";import{R as a,a as s,A as r}from"./constants-CFLPoYHQ.js";import{s as o,I as i,u as l,a as n,b as d,c,d as u}from"./index-BviM__eE.js";import{u as m,a as g}from"./query-BI71cv7L.js";import{T as x,q as h,o as v,b as p,B as f,j as b,r as j,F as N,n as y}from"./icons-TwYroKGA.js";import"./router-DVMx2JKX.js";import"./supabase-CfsjXCJe.js";import"./forms-BADiA78i.js";import"./utils-CwAUyRUs.js";import"./charts-C4lFoNLr.js";function w(){var w;const{user:M}=l(),_=()=>{if("super_admin"===(null==M?void 0:M.role))return"todos";var e;return(e=null==M?void 0:M.regional)&&{Nacional:"nacional",Comercial:"comercial","Centro-Oeste":"centro_oeste","MG/ES":"mg_es","Nordeste 1":"nordeste_1","Nordeste 2":"nordeste_2",Norte:"norte","Rio de Janeiro":"rj","São Paulo":"sp",Sul:"sul","R. Nacional":"nacional","R. Comercial":"comercial","R. Centro-Oeste":"centro_oeste","R. MG/ES":"mg_es","R. Nordeste 1":"nordeste_1","R. Nordeste 2":"nordeste_2","R. Norte":"norte","R. Rio de Janeiro":"rj","R. São Paulo":"sp","R. Sul":"sul"}[e]||"todos"},[C,L]=t.useState(()=>_()),[A,R]=t.useState(""),[q,S]=t.useState("todos"),[F,O]=t.useState("todos"),[D,z]=t.useState("todos"),{data:k,loading:E,error:T,refetch:I}=n(),{data:Y,loading:B}=d(),{data:P,loading:$}=c(),{data:J,loading:G,refetch:K}=u(),{data:Q,loading:V}=function(){const e=m(),{data:a,isLoading:s,error:r,refetch:l}=g({queryKey:["instituicoes"],queryFn:async()=>await i.getInstituicoes(),staleTime:0,gcTime:3e5,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!0});return t.useEffect(()=>{if(!o)return;const t=o.channel("instituicoes_changes").on("postgres_changes",{event:"*",schema:"public",table:"instituicoes"},t=>{e.invalidateQueries({queryKey:["instituicoes"]}),e.refetchQueries({queryKey:["instituicoes"]})}).subscribe();return()=>{o.removeChannel(t)}},[e]),{data:a||[],loading:s,error:(null==r?void 0:r.message)||null,refetch:l}}();t.useEffect(()=>{const e=_();L(e)},[M]);const W=E||B||G||$||V,H=Object.entries(a).filter(([e])=>"todas"!==e),U=t.useMemo(()=>{const e=(null==k?void 0:k.map(e=>e.equipe).filter(Boolean))||[],t=(null==Y?void 0:Y.map(e=>e.nome).filter(Boolean))||[];return Array.from(new Set([...e,...t,"Equipe SP","Equipe RJ","Equipe Nacional"])).sort()},[k,Y]),X=(null==k?void 0:k.flatMap(e=>[e.dataInicio?new Date(e.dataInicio).getFullYear():null,e.dataFim?new Date(e.dataFim).getFullYear():null].filter(Boolean)))||[],Z=(new Date).getFullYear(),ee=Math.min(...X.length?X:[Z]),te=Math.max(...X.length?X:[Z]),ae=Array.from({length:te+2-(ee-2)+1},(e,t)=>(ee-2+t).toString()),se=Array.from(new Set([...X.map(String),...ae])).sort(),re=e=>{if(!e)return"";let t=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/g,"").replace(/\s+/g," ").trim();return t=t.replace(/\bliga\b/g,"liga_s"),t=t.replace(/\bligas\b/g,"liga_s"),t=t.replace(/\bfamilia\b/g,"familia_s"),t=t.replace(/\bfamilias\b/g,"familia_s"),t=t.replace(/\bpessoa\b/g,"pessoa_s"),t=t.replace(/\bpessoas\b/g,"pessoa_s"),t=t.replace(/\batividade\b/g,"atividade_s"),t=t.replace(/\batividades\b/g,"atividade_s"),t},oe=(e,t)=>{if(!e||!t)return!1;const a=re(e),s=re(t);if(a===s)return!0;if(a.includes(s)||s.includes(a))return!0;const r=a.split(" ").filter(e=>e.length>2),o=s.split(" ").filter(e=>e.length>2);if(r.length>=2&&o.length>=2){if(r.filter(e=>o.includes(e)).length>=2)return!0}return!1},ie=(e,t)=>[e.titulo,e.descricao,e.nome,e.atividade_tipo,e.categoria].filter(Boolean).some(e=>oe(e,t)),le=(null==k?void 0:k.filter(e=>{var t,a,s,r;const o=!A||ie(e,A),i="todos"===C||e.regional===C||(null==(t=e.regional)?void 0:t.includes(C))||e.regionais&&Array.isArray(e.regionais)&&e.regionais.includes(C),l="todos"===q||(null==(a=e.equipe)?void 0:a.toLowerCase().trim())===q.toLowerCase().trim()||(null==(s=e.responsavel)?void 0:s.toLowerCase().trim())===q.toLowerCase().trim()||(null==(r=e.criado_por)?void 0:r.toLowerCase().trim())===q.toLowerCase().trim();let n=!0,d=!0;const c=String(F).trim(),u=String(D).trim(),m="todos"===c?null:c.padStart(2,"0");let g=null;if(e.ano)g=String(e.ano).trim();else if(e.dataInicio||e.data_inicio||e.created_at){const t=new Date(e.dataInicio??e.data_inicio??e.created_at);isNaN(t.getTime())||(g=String(t.getFullYear()))}if("todos"!==u&&g&&(d=u===g),null===m)n=!0;else if(Array.isArray(e.mes)&&e.mes.length>0){const t=e.mes.map(e=>String(e).trim().toLowerCase());n=!!t.includes("todo-ano")||t.map(e=>e.padStart(2,"0")).includes(m)}else if(e.dataInicio||e.data_inicio||e.created_at){const t=new Date(e.dataInicio??e.data_inicio??e.created_at);if(!isNaN(t.getTime())){n=String(t.getMonth()+1).padStart(2,"0")===m}}return o&&i&&l&&n&&d}))||[],ne=t.useMemo(()=>{if("todos"===F)return!0;const e=String(F).trim(),t=e.padStart(2,"0"),a=String(D).trim(),s=(null==k?void 0:k.filter(s=>{var r;let o=!0;"todos"!==C&&(o=s.regional===C||(null==(r=s.regional)?void 0:r.includes(C))||s.regionais&&Array.isArray(s.regionais)&&s.regionais.includes(C));let i=null;if(s.ano)i=String(s.ano).trim();else if(s.dataInicio||s.data_inicio||s.created_at){const e=new Date(s.dataInicio??s.data_inicio??s.created_at);isNaN(e.getTime())||(i=String(e.getFullYear()))}let l=!0;"todos"!==a&&(l=!!i&&a===i);let n=!0;if("todos"!==e)if(Array.isArray(s.mes)&&s.mes.length>0){const e=s.mes.map(e=>String(e).trim().toLowerCase());n=!!e.includes("todo-ano")||e.map(e=>e.padStart(2,"0")).includes(t)}else if(s.dataInicio||s.data_inicio||s.created_at){const e=new Date(s.dataInicio??s.data_inicio??s.created_at);if(isNaN(e.getTime()))n=!0;else{n=String(e.getMonth()+1).padStart(2,"0")===t}}else n=!0;return n&&l&&o}))||[],r=(null==J?void 0:J.filter(e=>{let s=!1,r=!0;const o=e=>{if(!e)return!1;const o=new Date(e);if(isNaN(o.getTime()))return!1;const i=String(o.getMonth()+1).padStart(2,"0"),l=String(o.getFullYear()),n=i===t;let d=!0;return"todos"!==a&&(d=a===l),s=s||n,r=r&&d,n&&d},i=o(e.activity_date)||o(e.data_inicio)||o(e.created_at);let l=!0;return l="todos"!==C?e.regional===C&&"ativo"===e.status:"ativo"===e.status,(i||s)&&r&&l}))||[];return s.length>0||r.length>0},[k,F,D,J,C]),de=t.useMemo(()=>{if(!le)return{totalMetas:0,metasConcluidas:0,metasEmAndamento:0,metasPendentes:0};if("todos"!==F&&!ne)return{totalMetas:0,metasConcluidas:0,metasEmAndamento:0,metasPendentes:0};if("todos"!==C){const e={nacional:7,centro_oeste:3,nordeste_1:3,nordeste1:3,nordeste_2:3,nordeste2:3,sul:3,norte:3,mg_es:3,mges:3,rj:3,rio:3,rio_de_janeiro:3,sp:0}[C]||le.length;return{totalMetas:e,metasConcluidas:0,metasEmAndamento:e,metasPendentes:0}}return{totalMetas:le.length,metasConcluidas:le.filter(e=>"concluida"===e.status||"completed"===e.status).length,metasEmAndamento:le.filter(e=>"em_andamento"===e.status||"in_progress"===e.status).length,metasPendentes:le.filter(e=>"pendente"===e.status||"pending"===e.status).length}},[le,C,F,ne]),ce=t.useMemo(()=>{if(!P||!J)return null;if("todos"!==F&&!ne){return{...P,total:0,resumo:{...P.resumo,ongsMaras:0,ongsDecolagem:0,ongsMicrocredito:0,totalPorArea:0,familiasEmbarcadas:0,diagnosticosRealizados:0,ligasMarasFormadas:0}}}if("todos"===C){const e=J.filter(e=>{var t,a;const s="ativo"===e.status;let r=!0;if("todos"!==q){const s=null==Y?void 0:Y.find(t=>t.id===e.responsavel_id);r=oe((null==s?void 0:s.nome)||"",q)||oe((null==s?void 0:s.email)||"",q)||oe((null==(t=e.responsavel)?void 0:t.nome)||"",q)||oe((null==(a=e.responsavel)?void 0:a.email)||"",q)}let o=!0,i=!0;if("todos"!==F){const t=e.activity_date||e.data_inicio||e.created_at;if(t){const e=new Date(t);if(!isNaN(e.getTime())){const t=e.getMonth()+1,a=e.getFullYear();o=Number(F)===t,"todos"!==D&&(i=Number(D)===a)}}}return s&&r&&o&&i}).reduce((e,t)=>{const a=t.atividade_label||t.titulo||"Outros";return e[a]||(e[a]=0),e[a]+=parseInt(t.quantidade)||0,e},{}),t=e["Ligas Maras Formadas"]||0,a=e["Famílias Embarcadas Decolagem"]||0,s=e["Diagnósticos Realizados"]||0;return{...P,resumo:{...P.resumo,familiasEmbarcadas:a,diagnosticosRealizados:s,ligasMarasFormadas:t}}}const e=J.filter(e=>{var t,a;const s=e.regional===C&&"ativo"===e.status;let r=!0;if("todos"!==q){const s=null==Y?void 0:Y.find(t=>t.id===e.responsavel_id);r=oe((null==s?void 0:s.nome)||"",q)||oe((null==s?void 0:s.email)||"",q)||oe((null==(t=e.responsavel)?void 0:t.nome)||"",q)||oe((null==(a=e.responsavel)?void 0:a.email)||"",q)}let o=!0,i=!0;if("todos"!==F){const t=e.activity_date||e.data_inicio||e.created_at;if(t){const e=new Date(t);if(!isNaN(e.getTime())){const t=e.getMonth()+1,a=e.getFullYear();o=Number(F)===t,"todos"!==D&&(i=Number(D)===a)}}}return s&&r&&o&&i}).reduce((e,t)=>{const a=t.atividade_label||t.titulo||"Outros";return e[a]||(e[a]=0),e[a]+=parseInt(t.quantidade)||0,e},{}),t=e["Ligas Maras Formadas"]||0,a=e["Famílias Embarcadas Decolagem"]||0,s=e["Diagnósticos Realizados"]||0,r=(null==Q?void 0:Q.filter(e=>{var t;return(null==(t=e.regional)?void 0:t.toLowerCase())===C.toLowerCase()}))||[],o=r.filter(e=>{var t,a;return(null==(t=e.tipo_programa)?void 0:t.toLowerCase().includes("maras"))||(null==(a=e.programa)?void 0:a.toLowerCase().includes("maras"))}).length,i=r.filter(e=>{var t,a;return(null==(t=e.tipo_programa)?void 0:t.toLowerCase().includes("decolagem"))||(null==(a=e.programa)?void 0:a.toLowerCase().includes("decolagem"))}).length,l=r.length;return{...P,total:l,resumo:{...P.resumo,ongsMaras:o,ongsDecolagem:i,ongsMicrocredito:0,totalPorArea:l,familiasEmbarcadas:a,diagnosticosRealizados:s,ligasMarasFormadas:t}}},[P,C,J,Q,F,ne,D,q,Y]),ue=t.useMemo(()=>{if(!J)return[];if("todos"!==F&&!ne){if("todos"!==C){const e=a[C]||C;return[{key:C,label:e,totalMeta:0,totalAtual:0,progress:0,quantidadeMetas:0,color:s[C]||"bg-gray-200"}]}return Object.keys(a).map(e=>({key:e,label:a[e],totalMeta:0,totalAtual:0,progress:0,quantidadeMetas:0,color:s[e]||"bg-gray-200"}))}if("todos"!==C){const e=J.filter(e=>{var t,a;const s=e.regional===C&&"ativo"===e.status;let r=!0;if("todos"!==q){const s=null==Y?void 0:Y.find(t=>t.id===e.responsavel_id);r=oe((null==s?void 0:s.nome)||"",q)||oe((null==s?void 0:s.email)||"",q)||oe((null==(t=e.responsavel)?void 0:t.nome)||"",q)||oe((null==(a=e.responsavel)?void 0:a.email)||"",q)}let o=!0,i=!0;if("todos"!==F){const t=e.activity_date||e.data_inicio||e.created_at;if(t){const e=new Date(t);if(!isNaN(e.getTime())){const t=e.getMonth()+1,a=e.getFullYear();o=Number(F)===t,"todos"!==D&&(i=Number(D)===a)}}}return s&&r&&o&&i}).reduce((e,t)=>{const a=t.titulo||t.tipo||"Outros";return e[a]||(e[a]={quantidade:0,atividades:[]}),e[a].quantidade+=parseInt(t.quantidade)||1,e[a].atividades.push(t),e},{}),t=Object.values(e).reduce((e,t)=>e+t.quantidade,0),r=(null==k?void 0:k.filter(e=>{if(!e.regional)return!1;if(e.regional.includes(",")){return e.regional.split(",").map(e=>e.trim()).some(e=>(Object.keys(a).find(t=>a[t].toLowerCase()===e.toLowerCase())||e)===C)}return(Object.keys(a).find(t=>a[t].toLowerCase()===e.regional.toLowerCase())||e.regional)===C}))||[],o=r.reduce((e,t)=>e+(t.valorMeta||t.valor_meta||0),0),i=a[C]||C;return[{key:C,label:i,totalMeta:o,totalAtual:t,progress:o>0?Math.min(t/o*100,100):0,quantidadeMetas:r.length,color:s[C]||"bg-gray-200",dadosReais:!0}]}const e="todos"===C&&""===A&&"todos"===q&&"todos"===F&&"todos"===D?k:le;if(!e||0===e.length)return[];if("todos"!==C){const t=a[C]||C;if(J){const e=J.filter(e=>e.regional===C&&"ativo"===e.status),a=e.reduce((e,t)=>e+(parseInt(t.quantidade)||1),0);return[{key:C,label:t,totalMeta:a,totalAtual:a,progress:a>0?100:0,quantidadeMetas:e.length,color:s[C]||"bg-gray-200",dadosReais:!0}]}const r=e.filter(e=>{if(!e.regional)return!1;if(e.regional.includes(",")){return e.regional.split(",").map(e=>e.trim()).some(e=>(Object.keys(a).find(t=>a[t].toLowerCase()===e.toLowerCase())||e)===C)}return(Object.keys(a).find(t=>a[t].toLowerCase()===e.regional.toLowerCase())||e.regional)===C}),o=r.reduce((e,t)=>e+(t.valorMeta||t.valor_meta||0),0),i=r.reduce((e,t)=>e+(t.valorAtual||t.valor_atual||0),0),l=o>0?Math.min(i/o*100,100):0,n=r.length;return[{key:C,label:t,totalMeta:o,totalAtual:i,progress:l,quantidadeMetas:n,color:s[C]||"bg-gray-200"}]}if(J){const e=J.filter(e=>{var t,a,s,r,o,i;const l="ativo"===e.status;let n=!0;if("todos"!==q){const l=null==Y?void 0:Y.find(t=>t.id===e.responsavel_id);n=(null==(t=null==l?void 0:l.nome)?void 0:t.toLowerCase().trim())===q.toLowerCase().trim()||(null==(a=null==l?void 0:l.email)?void 0:a.toLowerCase().trim())===q.toLowerCase().trim()||(null==(r=null==(s=e.responsavel)?void 0:s.nome)?void 0:r.toLowerCase().trim())===q.toLowerCase().trim()||(null==(i=null==(o=e.responsavel)?void 0:o.email)?void 0:i.toLowerCase().trim())===q.toLowerCase().trim()}let d=!0,c=!0;if("todos"!==F){const t=e.activity_date||e.data_inicio||e.created_at;if(t){const e=new Date(t);if(!isNaN(e.getTime())){const t=e.getMonth()+1,a=e.getFullYear();d=Number(F)===t,"todos"!==D&&(c=Number(D)===a)}}}return l&&n&&d&&c}).reduce((e,t)=>(e[t.regional]||(e[t.regional]=[]),e[t.regional].push(t),e),{});return Object.entries(e).map(([e,t])=>{const r=a[e]||e,o=t.reduce((e,t)=>e+(parseInt(t.quantidade)||1),0),i=(null==k?void 0:k.filter(t=>{if(!t.regional)return!1;if(t.regional.includes(",")){return t.regional.split(",").map(e=>e.trim()).some(t=>(Object.keys(a).find(e=>a[e].toLowerCase()===t.toLowerCase())||t)===e)}return(Object.keys(a).find(e=>a[e].toLowerCase()===t.regional.toLowerCase())||t.regional)===e}))||[],l=i.reduce((e,t)=>e+(t.valorMeta||t.valor_meta||0),0);return{key:e,label:r,totalMeta:l,totalAtual:o,progress:l>0?Math.min(o/l*100,100):0,quantidadeMetas:i.length,color:s[e]||"bg-gray-200",dadosReais:!0}}).sort((e,t)=>t.totalAtual-e.totalAtual)}const t=new Set;return e.forEach(e=>{if(e.regional)if(e.regional.includes(",")){e.regional.split(",").map(e=>e.trim()).forEach(e=>{const s=Object.keys(a).find(t=>a[t].toLowerCase()===e.toLowerCase())||e;t.add(s)})}else{const s=Object.keys(a).find(t=>a[t].toLowerCase()===e.regional.toLowerCase())||e.regional;t.add(s)}}),Array.from(t).map(t=>{const r=a[t]||t,o=e.filter(e=>{if(!e.regional)return!1;if(e.regional.includes(",")){return e.regional.split(",").map(e=>e.trim()).some(e=>(Object.keys(a).find(t=>a[t].toLowerCase()===e.toLowerCase())||e)===t)}return(Object.keys(a).find(t=>a[t].toLowerCase()===e.regional.toLowerCase())||e.regional)===t}),i=o.reduce((e,t)=>e+(t.valorMeta||t.valor_meta||0),0),l=o.reduce((e,t)=>e+(t.valorAtual||t.valor_atual||0),0),n=i>0?Math.min(l/i*100,100):0,d=o.length;return{key:t,label:r,totalMeta:i,totalAtual:l,progress:n,quantidadeMetas:d,color:s[t]||"bg-gray-200"}}).sort((e,t)=>t.progress-e.progress)},[k,le,C,A,q,F,D]),me=t.useMemo(()=>{if("todos"!==C&&J){const e=J.filter(e=>{var t,a;const s=e.regional===C&&"ativo"===e.status;let r=!0;if("todos"!==q){const s=null==Y?void 0:Y.find(t=>t.id===e.responsavel_id);r=oe((null==s?void 0:s.nome)||"",q)||oe((null==s?void 0:s.email)||"",q)||oe((null==(t=e.responsavel)?void 0:t.nome)||"",q)||oe((null==(a=e.responsavel)?void 0:a.email)||"",q)}let o=!0,i=!0;if("todos"!==F){const t=e.activity_date||e.data_inicio||e.created_at;if(t){const e=new Date(t);if(!isNaN(e.getTime())){const t=e.getMonth()+1,a=e.getFullYear();o=Number(F)===t,"todos"!==D&&(i=Number(D)===a)}}}return s&&r&&o&&i}).reduce((e,t)=>{const a=t.atividade_label||t.titulo||t.tipo||"Outros";e[a]||(e[a]={quantidade:0,atividades:[]});const s=parseInt(t.quantidade)||1;return e[a].quantidade+=s,e[a].atividades.push(t),e},{});return Object.entries(e).map(([e,t])=>{const s=(null==k?void 0:k.filter(t=>{var s;const r=t.regional&&(t.regional.includes(",")?t.regional.split(",").map(e=>e.trim()).some(e=>{var t;return e.toLowerCase().replace(/\s+/g,"_")===C||e.toLowerCase()===(null==(t=a[C])?void 0:t.toLowerCase())}):t.regional.toLowerCase().replace(/\s+/g,"_")===C||t.regional.toLowerCase()===(null==(s=a[C])?void 0:s.toLowerCase())),o=ie(t,e);return e.toLowerCase().includes("ligas")||e.toLowerCase().includes("maras"),r&&o}))||[],r=s.reduce((e,t)=>e+(t.valorMeta||t.valor_meta||0),0),o=e.toLowerCase().includes("nps")&&t.atividades.length>0?t.quantidade/t.atividades.length:t.quantidade,i=r>0?Math.min(o/r*100,100):0;return{label:e,value:e.toLowerCase().replace(/\s+/g,"_"),totalMeta:r,totalAtual:o,percentualRealizado:i,quantidadeMetas:s.length,dadosReais:!0,semMetas:0===r}}).sort((e,t)=>e.totalMeta>0&&0===t.totalMeta?-1:0===e.totalMeta&&t.totalMeta>0?1:t.totalAtual-e.totalAtual)}if("todos"===C&&J&&("todos"!==F||"todos"!==D||"todos"!==q||""!==A)){const e=J.filter(e=>{var t,a;const s="ativo"===e.status;let r=!0;if("todos"!==q){const s=null==Y?void 0:Y.find(t=>t.id===e.responsavel_id);r=oe((null==s?void 0:s.nome)||"",q)||oe((null==s?void 0:s.email)||"",q)||oe((null==(t=e.responsavel)?void 0:t.nome)||"",q)||oe((null==(a=e.responsavel)?void 0:a.email)||"",q)}let o=!0,i=!0;const l=e.activity_date||e.data_inicio||e.created_at;if("todos"!==F&&l){const e=new Date(l);if(!isNaN(e.getTime())){const t=e.getMonth()+1,a=e.getFullYear();o=Number(F)===t,"todos"!==D&&(i=Number(D)===a)}}else if("todos"!==D&&l){const e=new Date(l);isNaN(e.getTime())||(i=Number(D)===e.getFullYear())}let n=!0;if(""!==A){const t=e.atividade_label||e.titulo||e.tipo||"Outros";n=ie({titulo:t},A)}return s&&r&&o&&i&&n}).reduce((e,t)=>{const a=t.atividade_label||t.titulo||t.tipo||"Outros";return e[a]||(e[a]={quantidade:0,atividades:[]}),e[a].quantidade+=parseInt(t.quantidade)||1,e[a].atividades.push(t),e},{});return Object.entries(e).map(([e,t])=>{var a;const s=(null==(a=le||k)?void 0:a.filter(t=>ie(t,e)))||[],r=s.reduce((e,t)=>e+(t.valorMeta||t.valor_meta||0),0),o=e.toLowerCase().includes("nps")&&t.atividades.length>0?t.quantidade/t.atividades.length:t.quantidade,i=r>0?Math.min(o/r*100,100):0;return{label:e,value:e.toLowerCase().replace(/\s+/g,"_"),totalMeta:r,totalAtual:o,percentualRealizado:i,quantidadeMetas:s.length,dadosReais:!0,semMetas:0===r}}).sort((e,t)=>e.totalMeta>0&&0===t.totalMeta?-1:0===e.totalMeta&&t.totalMeta>0?1:t.totalAtual-e.totalAtual)}const e="todos"===C&&""===A&&"todos"===q&&"todos"===F&&"todos"===D?k:le;if(!e||0===e.length)return[];const t="todos"===C&&""===A&&"todos"===q&&"todos"===F&&"todos"===D;return r.filter(({label:e})=>"outra"!==e.toLowerCase()).reduce((e,t)=>(e.find(e=>e.label===t.label)||e.push(t),e),[]).map(({label:a,value:s})=>{const r=e.filter(e=>ie(e,a)),o=r.reduce((e,t)=>e+(t.valorMeta||t.valor_meta||0),0);let i=0;if(t&&J){const e=J.filter(e=>{const t=e.atividade_label||e.titulo||e.tipo||"Outros";return ie({titulo:t},a)&&"ativo"===e.status});if(a.toLowerCase().includes("nps"))if(e.length>0){const t=e.reduce((e,t)=>e+(parseFloat(t.quantidade)||0),0);i=Number((t/e.length).toFixed(1))}else i=0;else i=e.reduce((e,t)=>e+(parseInt(t.quantidade)||1),0)}else i=r.reduce((e,t)=>e+(t.valorAtual||t.valor_atual||0),0);const l=o>0?i/o*100:0,n=r.length;return{label:a,value:s,totalMeta:o,totalAtual:i,percentualRealizado:l,quantidadeMetas:n}}).filter(e=>e.quantidadeMetas>0).sort((e,t)=>t.percentualRealizado-e.percentualRealizado)},[k,le,C,A,q,F,D,J,Y]);return t.useEffect(()=>{!W&&I&&I(),!G&&K&&K()},[A,C,q,F,D,I,K,W,G]),W?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando metas..."})]})}):T?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-600 mb-4",children:e.jsx(x,{className:"w-12 h-12 mx-auto"})}),e.jsxs("p",{className:"text-gray-600",children:["Erro ao carregar metas: ",T]})]})}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx("div",{className:"flex flex-col space-y-4 sm:flex-row sm:items-center sm:justify-between sm:space-y-0",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:"Dashboard Metas"}),e.jsx("p",{className:"mt-1 text-sm sm:text-base text-gray-600",children:"Acompanhe o progresso das metas estabelecidas"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-lg hover:border-blue-300 hover:-translate-y-1 transition-all duration-300 cursor-pointer",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total de Metas"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:de.totalMetas})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center group-hover:bg-blue-200 transition-colors duration-300",children:e.jsx(x,{className:"w-6 h-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-lg hover:border-green-300 hover:-translate-y-1 transition-all duration-300 cursor-pointer",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Concluídas"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:de.metasConcluidas})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center group-hover:bg-green-200 transition-colors duration-300",children:e.jsx(h,{className:"w-6 h-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-lg hover:border-blue-300 hover:-translate-y-1 transition-all duration-300 cursor-pointer",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Famílias Embarcadas Decolagem"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:$?"...":(null==ce?void 0:ce.resumo.familiasEmbarcadas)||0})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center group-hover:bg-blue-200 transition-colors duration-300",children:e.jsx(v,{className:"w-6 h-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-lg hover:border-amber-300 hover:-translate-y-1 transition-all duration-300 cursor-pointer",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Ligas Maras Formadas"}),e.jsx("p",{className:"text-3xl font-bold text-amber-600",children:$?"...":(null==(w=null==ce?void 0:ce.resumo)?void 0:w.ligasMarasFormadas)||0})]}),e.jsx("div",{className:"w-12 h-12 bg-amber-100 rounded-lg flex items-center justify-center group-hover:bg-amber-200 transition-colors duration-300",children:e.jsx(p,{className:"w-6 h-6 text-amber-600"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-lg hover:border-purple-300 hover:-translate-y-1 transition-all duration-300 cursor-pointer",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Instituições"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:$?"...":(null==ce?void 0:ce.total)||0})]}),e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center group-hover:bg-purple-200 transition-colors duration-300",children:e.jsx(f,{className:"w-6 h-6 text-purple-600"})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-lg hover:border-pink-300 hover:-translate-y-1 transition-all duration-300 cursor-pointer",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"ONGs Maras"}),e.jsx("p",{className:"text-3xl font-bold text-pink-600",children:$?"...":(null==ce?void 0:ce.resumo.ongsMaras)||0})]}),e.jsx("div",{className:"w-12 h-12 bg-pink-100 rounded-lg flex items-center justify-center group-hover:bg-pink-200 transition-colors duration-300",children:e.jsx(v,{className:"w-6 h-6 text-pink-600"})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-lg hover:border-indigo-300 hover:-translate-y-1 transition-all duration-300 cursor-pointer",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"ONGs Decolagem"}),e.jsx("p",{className:"text-3xl font-bold text-indigo-600",children:$?"...":(null==ce?void 0:ce.resumo.ongsDecolagem)||0})]}),e.jsx("div",{className:"w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center group-hover:bg-indigo-200 transition-colors duration-300",children:e.jsx(b,{className:"w-6 h-6 text-indigo-600"})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-lg hover:border-emerald-300 hover:-translate-y-1 transition-all duration-300 cursor-pointer",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Diagnósticos Realizados"}),e.jsx("p",{className:"text-3xl font-bold text-emerald-600",children:$?"...":(null==ce?void 0:ce.resumo.diagnosticosRealizados)||0})]}),e.jsx("div",{className:"w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center group-hover:bg-emerald-200 transition-colors duration-300",children:e.jsx(j,{className:"w-6 h-6 text-emerald-600"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsx(N,{className:"w-5 h-5 text-gray-400"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-700",children:"Filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-medium text-gray-600 mb-1",children:"Atividade"}),e.jsxs("select",{value:A,onChange:e=>R(e.target.value),className:"input-sm text-sm border-gray-300 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"",children:"Todas"}),r.filter(e=>"outra"!==e.label.toLowerCase()).map(t=>e.jsx("option",{value:t.label,children:t.label},t.label))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-medium text-gray-600 mb-1",children:"Área"}),e.jsxs("select",{value:C,onChange:e=>L(e.target.value),className:"input-sm text-sm border-gray-300 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"todos",children:"Todos"}),H.map(([t,a])=>e.jsx("option",{value:t,children:a},t))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-medium text-gray-600 mb-1",children:"Equipe"}),e.jsxs("select",{value:q,onChange:e=>S(e.target.value),className:"input-sm text-sm border-gray-300 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"todos",children:"Todos"}),U.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-medium text-gray-600 mb-1",children:"Mês"}),e.jsxs("select",{value:F,onChange:e=>O(e.target.value),className:"input-sm text-sm border-gray-300 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"todos",children:"Todos"}),e.jsx("option",{value:"1",children:"Janeiro"}),e.jsx("option",{value:"2",children:"Fevereiro"}),e.jsx("option",{value:"3",children:"Março"}),e.jsx("option",{value:"4",children:"Abril"}),e.jsx("option",{value:"5",children:"Maio"}),e.jsx("option",{value:"6",children:"Junho"}),e.jsx("option",{value:"7",children:"Julho"}),e.jsx("option",{value:"8",children:"Agosto"}),e.jsx("option",{value:"9",children:"Setembro"}),e.jsx("option",{value:"10",children:"Outubro"}),e.jsx("option",{value:"11",children:"Novembro"}),e.jsx("option",{value:"12",children:"Dezembro"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-medium text-gray-600 mb-1",children:"Ano"}),e.jsxs("select",{value:D,onChange:e=>z(e.target.value),className:"input-sm text-sm border-gray-300 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"todos",children:"Todos"}),se.map(t=>e.jsx("option",{value:t,children:t},t))]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(j,{className:"w-6 h-6 text-indigo-600"}),e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:"Detalhamento por Área"})]}),e.jsxs("span",{className:"text-sm text-gray-500 bg-gray-50 px-3 py-1 rounded-full",children:[ue.filter(e=>e.quantidadeMetas>0).length," áreas ativas"]})]}),0===ue.filter(e=>e.quantidadeMetas>0).length?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx(j,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Nenhuma meta encontrada para as áreas com os filtros selecionados."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Ajuste os filtros para ver mais resultados."})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:ue.filter(e=>e.quantidadeMetas>0).map(t=>e.jsxs("div",{className:"group bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-lg transition-all duration-300 hover:-translate-y-1",children:[e.jsxs("div",{className:`p-4 ${t.color} bg-opacity-10 border-b border-gray-100`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:t.label}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-xs px-2 py-1 rounded-full bg-white/80 text-gray-700 font-medium",children:[t.progress.toFixed(1),"%"]}),e.jsx(v,{className:"w-4 h-4 text-gray-600"})]})]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[t.quantidadeMetas," metas ativas"]})]}),e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Realizado"}),e.jsx("div",{className:"text-xl font-bold text-emerald-600",children:t.totalAtual.toLocaleString("pt-BR")})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Meta"}),e.jsx("div",{className:"text-xl font-bold text-indigo-600",children:t.totalMeta.toLocaleString("pt-BR")})]})]}),e.jsx("div",{className:"w-full h-3 bg-gray-200 rounded-full overflow-hidden mb-3",children:e.jsx("div",{className:"h-3 rounded-full transition-all duration-700 ease-out",style:{width:`${t.progress}%`,background:t.progress>=80?"linear-gradient(90deg, #10b981, #059669)":t.progress>=50?"linear-gradient(90deg, #f59e0b, #d97706)":"linear-gradient(90deg, #ef4444, #dc2626)"}})}),e.jsx("div",{className:"flex items-center justify-center text-xs",children:e.jsx("span",{className:"text-gray-500",children:t.progress>=80?"🎯 Excelente":t.progress>=50?"⚡ Bom progresso":"🚀 Precisa atenção"})})]})]},t.key))})]}),e.jsxs("div",{className:"space-y-4 mt-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(y,{className:"w-6 h-6 text-emerald-600"}),e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:"Detalhamento por Atividade"})]}),e.jsxs("span",{className:"text-sm text-gray-500 bg-gray-50 px-3 py-1 rounded-full",children:[me.length," atividades ativas"]})]}),0===me.length?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx(y,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Nenhuma atividade encontrada com os filtros selecionados."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Ajuste os filtros para ver mais resultados."})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:me.map(t=>{const a=Math.max(0,100-t.percentualRealizado),s=t.percentualRealizado>=80?"emerald":t.percentualRealizado>=50?"amber":"rose";return e.jsxs("div",{className:"group bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-lg transition-all duration-300 hover:-translate-y-1",children:[e.jsxs("div",{className:`p-4 bg-gradient-to-r from-${s}-50 to-${s}-100 border-b border-gray-100 ${t.semMetas?"border-l-4 border-l-orange-400":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:t.label}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full bg-white/80 text-${s}-700 font-medium`,children:t.semMetas?"Sem meta":`${t.percentualRealizado.toFixed(1)}%`})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:t.semMetas?"⚠️ Nenhuma meta cadastrada":`${t.quantidadeMetas} metas ativas`})]}),e.jsx("div",{className:"p-5",children:t.semMetas?e.jsxs("div",{className:"text-center py-4",children:[e.jsxs("div",{className:"rounded-lg p-4 bg-orange-50 border border-orange-200 mb-4",children:[e.jsx("div",{className:"text-sm font-medium text-orange-800 mb-2",children:"Atividades Realizadas"}),e.jsx("div",{className:"text-2xl font-bold text-orange-900",children:t.totalAtual.toLocaleString("pt-BR")})]}),e.jsx("div",{className:"text-xs text-orange-600 bg-orange-50 px-3 py-2 rounded-lg",children:"📋 Esta atividade não possui metas cadastradas no sistema"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[e.jsxs("div",{className:"rounded-lg p-3 bg-emerald-50 border border-emerald-100 text-center",children:[e.jsx("div",{className:"text-xs font-medium text-emerald-700 mb-1",children:"Realizado"}),e.jsxs("div",{className:"text-sm font-bold text-emerald-800",children:[t.percentualRealizado.toFixed(1),"%"]})]}),e.jsxs("div",{className:"rounded-lg p-3 bg-indigo-50 border border-indigo-100 text-center",children:[e.jsx("div",{className:"text-xs font-medium text-indigo-700 mb-1",children:"Meta"}),e.jsx("div",{className:"text-sm font-bold text-indigo-800",children:"100%"})]}),e.jsxs("div",{className:"rounded-lg p-3 bg-rose-50 border border-rose-100 text-center",children:[e.jsx("div",{className:"text-xs font-medium text-rose-700 mb-1",children:"Falta"}),e.jsxs("div",{className:"text-sm font-bold text-rose-800",children:[a.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mb-1",children:[e.jsx("span",{children:"Valores absolutos"}),e.jsxs("span",{children:[t.totalAtual.toLocaleString("pt-BR")," / ",t.totalMeta.toLocaleString("pt-BR")]})]}),e.jsx("div",{className:"w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-2 rounded-full transition-all duration-700 ease-out",style:{width:`${t.percentualRealizado}%`,background:t.percentualRealizado>=80?"linear-gradient(90deg, #10b981, #059669)":t.percentualRealizado>=50?"linear-gradient(90deg, #f59e0b, #d97706)":"linear-gradient(90deg, #ef4444, #dc2626)"}})})]}),e.jsx("div",{className:"flex items-center justify-center text-xs",children:e.jsx("span",{className:"text-gray-500",children:t.percentualRealizado>=80?"🏆 Meta quase alcançada":t.percentualRealizado>=50?"📈 Progresso sólido":"🎯 Foco necessário"})})]})})]},t.label)})})]})]})}export{w as default};
